---
layout: post
title: "코드를 비활성화하는 방법: 개발자의 프로덕션 킬 스위치"
author: "CSS Dev"
thumbnail: "undefined"
tags: 
---


다음은 카를로스 슐츠가 작성한 게스트 포스트이다.

프로덕션에서 코드를 비활성화할 수 있다는 것은 많은 개발자들이 알지 못하는 힘입니다. 아깝다. 코드베이스의 일부 또는 전체 기능을 끄는 기능을 통해 피드백 주기를 단축하고 전반적인 품질을 높일 수 있는 모범 사례를 허용함으로써 소프트웨어 개발 프로세스를 크게 개선할 수 있습니다.

그래서, 이것이 바로 이 게시물입니다. 여러분이 이 스위치를 끄는데 사용할 수 있는 메커니즘, 그것들이 왜 유용한지, 그리고 어떻게 시작하는지를 다룹니다. 들어가자.

### 코드를 비활성화하려는 이유는 무엇입니까?

기능 플래그에 대해 자세히 알아보기 전에 기능 플래그가 무엇인지, 그리고 기능 플래그가 구현되는 방법을 설명하려면 다음과 같은 질문을 해야 합니다. 왜 사람들은 그들의 코드베이스의 일부분을 끄려고 하는가? 그렇게 하면 무슨 이득이 있나요?

이러한 질문에 답하기 위해, 우리는 시간을 거슬러 소프트웨어가 어떻게 20년 전에 개발되었는지 살펴봐야 합니다. 역사 수업 시간!

![image](https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/06/image2.png?resize=1000%2C200&ssl=1)

역사적으로, 통합은 함께 소프트웨어를 개발하려는 팀에게 가장 어려운 과제 중 하나입니다.

조직 내에서 몇 개 팀이 몇 개월 동안 개별적으로 작업하고 각 팀이 고유한 기능을 개발하는 모습을 상상해 보십시오. 팀이 완전히 격리된 상태에서 작업하는 동안 애플리케이션 버전은 서로 다른 방향으로 진화하고 있었습니다. 이제 그들은 충돌하지 않는 단일 버전으로 다시 모여야 한다. 이것은 정말 힘든 일이다.

이것이 바로 "통합 지옥"의 의미이다: 너무 오랫동안 분리가 허용된 동일한 애플리케이션의 버전을 병합하려는 투쟁이다.

"아프면 더 자주 하세요." 이 말이 의미하는 것은 푸는 것이 힘들기 때문에 미루는 문제가 있다는 것이다. 이러한 문제를 자주 발견하게 되는 것은 문제가 누적되기 전에 문제를 더 자주 해결하는 것이 훨씬 덜 고통스럽거나 심지어 사소한 일이라는 것입니다.

그렇다면 어떻게 하면 통합을 덜 고통스럽게 만들 수 있을까요? 더 자주 통합합니다.

즉, CI(Continuous Integration)를 통해 최소한 하루에 한 번은 개발자가 작업을 공용 공유 저장소와 통합할 수 있습니다. 다른 사용자가 작업을 통합할 때마다 서버가 빌드를 트리거하고 자동 테스트 제품군을 실행하도록 합니다. 그렇게 하면 문제가 생기면, 그들은 더 빨리 노출된다.

![image](https://i0.wp.com/rollout.io/blog/wp-content/uploads/sites/2/2020/05/image1.png?ssl=1)

많은 팀이 CI에서 어려움을 겪고 있는 한 가지 과제는 완료되지 않은 기능을 처리하는 방법입니다. 개발자들이 그들의 코드를 메인 라인에 병합하는 경우, 그것은 완료하는데 하루 이상 걸리는 모든 개발은 여러 부분으로 분할되어야 한다는 것을 의미한다.

고객이 완료되지 않은 기능에 액세스하지 않도록 하려면 어떻게 해야 합니까? 유사한 사소한 솔루션을 사용하는 몇 가지 사소한 시나리오가 있지만, 더 어려운 시나리오에서는 다른 접근 방식, 즉 코드의 일부를 완전히 끄는 기능을 요구한다.

### 구조에 대한 기능 플래그

개발자가 코드의 일부를 껐다 켰다 할 수 있도록 하는 메커니즘에 대한 많은 이름이 있다. 일부는 이를 "기능 토글" 또는 "킬 스위치"라고 부릅니다. 하지만 "feature flags"가 가장 인기 있는 이름이기 때문에 이 게시물의 나머지 부분에 사용할 것입니다. 그러면, 특징 깃발이란 무엇일까요?

간단히 말해, 기능 플래그는 팀이 코드를 수정하지 않고도 응용 프로그램의 동작을 변경할 수 있도록 하는 기술이다. 일반적으로 플래그는 여러 가지 이유로 아직 프로덕션에 적합하지 않기 때문에 사용자가 코드 조각에 의해 도입된 변경 사항에 액세스하여 사용하지 못하도록 하는 데 사용됩니다.

이제 프로덕션에서 코드를 비활성화하기 위한 가장 일반적인 사용 사례에 대해 살펴보겠습니다.

보시다시피 기능 플래그의 주요 사용 사례 중 하나는 사용자가 아직 사용할 준비가 되지 않은 기능에 액세스하지 못하게 하는 것입니다.

이렇게 하면, 더 복잡하고 완료하는 데 더 오랜 시간이 걸리는 기능을 개발하는 프로그래머들은 작업을 자주 통합하고 이점을 누리는 것을 막을 수 없습니다.

기능 플래그를 채택하면 소프트웨어 개발 프로세스에서 몇 가지 중요한 관행을 사용할 수 있으며, 그 중 하나가 A/B 테스트입니다.

A/B 테스트는 두 가지 버전의 웹 사이트나 응용 프로그램을 비교하여 어느 버전을 유지할 것인지 결정하는 사용자 경험 연구 기법이다. 여기에는 사용자를 무작위로 A와 B의 두 그룹으로 나눈 다음 각 그룹에 다른 버전의 애플리케이션을 전달하는 과정이 포함된다. 한 그룹은 현재 생산 버전을 받을 수 있는데, 우리는 이를 "제어"라고 부르는 반면, 두 번째 그룹은 "처리"라고 불리는 새로운 버전의 후보자를 받을 것이다.

그런 다음 테스터는 두 그룹의 동작을 모니터링하고 어떤 버전이 더 나은 결과를 얻었는지 확인합니다.

기능 플래그를 사용하면 응용 프로그램의 제어 버전과 처리 버전 사이에서 빠르고 편리하게 변경할 수 있기 때문에 A/B 테스트를 실행할 수 있습니다.

![image](https://i1.wp.com/rollout.io/blog/wp-content/uploads/sites/2/2020/05/image4.png?ssl=1)

앱의 새 버전을 전체 사용자 기반에 한 번에 제공할 경우 릴리스가 잘못된 경우 사용자의 100%가 영향을 받습니다. 대신 새로운 버전을 점진적으로 출시할 수 있다면 어떨까요? 먼저 소규모 사용자에게 배포하여 해당 그룹을 모니터링하여 문제를 탐지할 수 있습니다. 뭔가 잘못됐으면 다시 굴릴 수 있어요. 모든 것이 정상으로 보이면 점차 더 큰 그룹에 대한 버전을 릴리스할 수 있습니다. 그것은 간단히 말해서 카나리아 방류이다. 이것은 깃발을 특징으로 하는 또 다른 강력한 기술입니다.

특정 사용자의 필요에 따라 애플리케이션을 사용자 정의해야 하는 경우가 드물지 않습니다. 소프트웨어 팀이 이러한 작업을 수행할 수 있는 방법은 여러 가지가 있습니다. 일부는 더 효율적이기도 하고 일부는 덜 효율적이기도 합니다(각 클라이언트를 위해 별도의 지점 또는 전체 저장소를 만드는 회사).

이것은 팀이 동일한 기능의 다른 버전 간에 동적으로 전환할 수 있도록 하는 기능 플래그가 도움이 될 수 있는 또 다른 영역입니다.

### 프로덕션 101에서 코드 사용 안 함

코드를 비활성화하려면 어떻게 해야 합니까? 이것이 우리가 지금 보게 될 3단계의 점점 더 복잡해지는 단계입니다.

우리는 매우 원시적인 접근법부터 시작하는데, 이것은 기능 깃발이라고 여겨서는 안 될 것입니다. 아래의 의사 코드를 고려하십시오.

```js
calculateAdditionalWorkHours(Employee employee, Date start, Date end) {
  // return calculateAdditionalWorkHoursSameOldWay(employee, start, end);
  return calculateAdditionalWorkHoursImproved(employee, start, end);
}
```

위의 코드에서, 우리는 단지 어떤 수법의 이전 버전에 대한 의견을 제시하고 그것을 새로운 버전으로 바꾸고 있다. 이전 버전을 사용하고 싶을 때는 반대로만 합니다. (음, 원시적이라고 말했지.) 이 접근 방식은 기능 플래그의 가장 기본적인 속성 중 하나인 코드를 변경하지 않고 응용 프로그램이 작동하는 방식을 변경하는 기능이 없습니다.

하지만, 그것은 더 정교한 접근을 위해 씨앗을 심습니다.

이전 접근 방식은 개발자가 코드를 변경하지 않고 원하는 버전의 기능을 선택할 수 있도록 허용하지 않았습니다. 다행히 그렇게 어려운 일은 아닙니다. 먼저, 사용할 버전을 결정하기 위한 논리 변수를 소개합니다.

```js
calculateAdditionalWorkHours(Employee employee, Date start, Date end) {

  var result = useNewCalculation
    ? calculateAdditionalWorkHoursImproved(employee, start, end)
    : calculateAdditionalWorkHoursSameOldWay(employee, start, end);

  return result;
}
```

그런 다음 외부 소스에서 변수에 값을 할당할 수 있는 메커니즘을 사용한다. 구성 파일을 사용할 수 있습니다.

```js
var useNewCalculation = config[newCalculation];
```

응용 프로그램에 인수를 전달하는 것도 다른 옵션일 수 있습니다. 중요한 것은 이제 앱이 외부에서 어떻게 동작하는지 수정할 수 있는 기능을 갖게 되었다는 점입니다. 이 기능은 "진정한" 기능으로 전환하기 위한 훌륭한 단계입니다.

보이는 코드 예제는 모두 유사 코드입니다. 여러분이 좋아하는 프로그래밍 언어를 사용하면, 여러분이 이 접근법으로부터 시작해서 한 단계 올라가는 것을 막을 수 없습니다. 예를 들어 클래스를 사용하여 특성 및 설계 패턴(예: 공장)을 나타내어 문을 사용하지 않도록 할 수 있습니다.

![image](https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/image3-1.png?resize=1000%2C200&ssl=1)

프로그램에 플래그 수가 적은 경우 이전 접근 방식으로 충분할 수 있습니다. 하지만 그 숫자가 증가함에 따라, 상황은 더 흐트러지기 시작합니다.

첫째, 기술 부채 문제가 있습니다. 수동으로 구현한 기능 플래그를 사용하면 코드베이스에 매우 혼란스러운 조건부 흐름이 발생할 수 있습니다. 그것은 매일 새로운 깃발이 도입되면서 더 악화될 뿐이다. 또한, 특히 더 많은 주니어 개발자들에게는 버그를 초대하는 코드를 이해하고 탐색하기가 더 어려워질 수 있습니다.

또 다른 문제는 깃발의 수가 증가함에 따라 오래되고 낡은 깃발을 지우는 것을 잊는 것이 점점 더 흔해진다는 것이다.

자체 개발 방식의 주요 문제는 모든 플래그를 한 번에 보고 관리할 수 있는 쉬운 방법을 제공하지 않는다는 것입니다. 이러한 이유로 세 번째이자 마지막 단계는 하나의 조언입니다. 사용자 자신의 기능 플래그 접근 방식을 롤아웃하는 대신 타사 기능 플래그 관리 시스템을 채택하십시오.

![image](https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/06/image3-1-1.png?resize=1000%2C200&ssl=1)

### 기능 플래그 영역 CI/CD 지원 장치

우리는 개발자들이 코드를 만질 필요 없이 그들의 생산에서 코드베이스의 일부를 비활성화하기 위해 사용할 수 있는 메커니즘을 다루었다. 이 기능은 강력하며 A/B 테스트 및 카나리아 릴리스와 같은 기술을 가능하게 하며, 이는 모두 현대적이고 민첩한 기반 소프트웨어 개발 프로세스의 특징입니다.

기술 이름은 기능 플래그, 기능 토글, 기능 플리퍼 등 다양할 수 있습니다. 기술을 구현하는 방식도 간단한 if 문장에서 정교한 클라우드 기반 솔루션에 이르기까지 다양할 수 있습니다.

하지만 여러분이 그들을 뭐라고 부르든 간에, 여러분은 이러한 메커니즘이 제공하는 혜택을 과대평가할 수 없습니다. 이러한 통합은 지속적인 통합을 가능하게 합니다. 지속적인 통합을 원하는 모든 현대 소프트웨어 조직에 필수적입니다.