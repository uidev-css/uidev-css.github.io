<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>ë¹ ë¥¸ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT ì¸ì¦ êµ¬í˜„í•˜ê¸° | uidev-css</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://uidev-css.github.io///post/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="ë¹ ë¥¸ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT ì¸ì¦ êµ¬í˜„í•˜ê¸° | uidev-css" data-gatsby-head="true"/><meta property="og:title" content="ë¹ ë¥¸ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT ì¸ì¦ êµ¬í˜„í•˜ê¸° | uidev-css" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://uidev-css.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://uidev-css.github.io///post/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication" data-gatsby-head="true"/><meta name="twitter:title" content="ë¹ ë¥¸ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT ì¸ì¦ êµ¬í˜„í•˜ê¸° | uidev-css" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | uidev-css" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-20 14:08" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b4eed7811784bdd3.js" defer=""></script><script src="/_next/static/9ddMoNNI_mr3kv4sKx3b_/_buildManifest.js" defer=""></script><script src="/_next/static/9ddMoNNI_mr3kv4sKx3b_/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UIDEV CSS</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">ë¹ ë¥¸ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT ì¸ì¦ êµ¬í˜„í•˜ê¸°</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="ë¹ ë¥¸ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT ì¸ì¦ êµ¬í˜„í•˜ê¸°" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UIDEV CSS</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 20, 2024</span><span class="posts_reading_time__f7YPP">9<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>ì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT (JSON Web Token) ì¸ì¦ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•˜ê² ìŠµë‹ˆë‹¤. JWTëŠ” ë‘ ë‹¹ì‚¬ì ê°„ì— ì£¼ì¥ì„ ë‚˜íƒ€ë‚´ëŠ” ì»´íŒ©íŠ¸í•˜ê³  URL-ì•ˆì „í•œ ìˆ˜ë‹¨ìœ¼ë¡œ, ë³´ì•ˆ ì¸ì¦ì— ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
<p><img src="/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png" alt="ì´ë¯¸ì§€"></p>
<h2>JWTë€ ë¬´ì—‡ì¸ê°€ìš”?</h2>
<p>JWTëŠ” JSON Web Tokenì˜ ì•½ìì…ë‹ˆë‹¤. ì¼ë¶€ ì£¼ì¥ì„ ë‚˜íƒ€ë‚´ëŠ” í† í°ì„ ìƒì„±í•˜ê¸° ìœ„í•œ í‘œì¤€ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í† í°ë“¤ì€ ë¹„ë°€ í‚¤ ë˜ëŠ” ê³µê°œ/ê°œì¸ í‚¤ ìŒìœ¼ë¡œ ì„œëª…ë©ë‹ˆë‹¤. ë‹¤ìŒì€ JWTê°€ ì‘ë™í•˜ëŠ” ê°„ë‹¨í•œ ì„¤ëª…ì…ë‹ˆë‹¤:</p>
<div class="content-ad"></div>
<ul>
<li>í—¤ë”: ì¼ë°˜ì ìœ¼ë¡œ í† í° ìœ í˜• (JWT)ê³¼ ì„œëª… ì•Œê³ ë¦¬ì¦˜ (ì˜ˆ: HMAC SHA256 ë˜ëŠ” RSA)ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.</li>
</ul>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"alg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"HS256"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"typ"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JWT"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>í˜ì´ë¡œë“œ: í´ë ˆì„ì€ ê°œì²´(ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ì)ì— ê´€í•œ ë¬¸ì¥ê³¼ ì¶”ê°€ ë°ì´í„°ì…ë‹ˆë‹¤.</li>
</ul>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rajan"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rajan12@rajan.com"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<div class="content-ad"></div>
<ul>
<li>ì„œëª…: ì„œëª… ë¶€ë¶„ì„ ë§Œë“¤ë ¤ë©´ ì¸ì½”ë”©ëœ í—¤ë”, ì¸ì½”ë”©ëœ í˜ì´ë¡œë“œ, ë¹„ë°€í‚¤ ë° í—¤ë”ì—ì„œ ì§€ì •í•œ ì•Œê³ ë¦¬ì¦˜ì„ ê°€ì ¸ ì™€ì•¼ í•©ë‹ˆë‹¤.</li>
</ul>
<pre><code class="hljs language-js"># secret id
<span class="hljs-title class_">ABjhjdsjfsh234</span>fjhuih324$jihdfdshkgsog
</code></pre>
<h2>JWTì˜ ì¥ì :</h2>
<ul>
<li>ê°„ê²°í•¨: JWTëŠ” ê°„ê²°í•˜ë©° URL, POST ë§¤ê°œë³€ìˆ˜ ë˜ëŠ” HTTP í—¤ë” ì•ˆì— ì „ì†¡í•  ìˆ˜ ìˆì–´ ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©í•©ë‹ˆë‹¤.</li>
<li>ìì²´ í¬í•¨: í˜ì´ë¡œë“œì—ëŠ” ì¸ì¦ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆì–´ ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
</ul>
<div class="content-ad"></div>
<h2>FastAPIì—ì„œì˜ ë‹¨ê³„ë³„ êµ¬í˜„</h2>
<h2>ë‹¨ê³„ 1: ì˜ì¡´ì„± ì„¤ì •</h2>
<p>ë¨¼ì €, FastAPIì™€ ê´€ë ¨ ì˜ì¡´ì„±ì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:</p>
<pre><code class="hljs language-js">pip install fastapi 
pip install passlib 
pip install python-jose
</code></pre>
<div class="content-ad"></div>
<h2>ë‹¨ê³„ 2: ëª¨ë¸ ë° ìŠ¤í‚¤ë§ˆ ì •ì˜</h2>
<p>ì‚¬ìš©ì ëª¨ë¸ê³¼ ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•  ê²ƒì…ë‹ˆë‹¤.</p>
<h2>models.py</h2>
<pre><code class="hljs language-python"><span class="hljs-comment"># models.py</span>

<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    username: <span class="hljs-built_in">str</span>
    email: <span class="hljs-built_in">str</span>
    hashed_password: <span class="hljs-built_in">str</span>

<span class="hljs-comment"># ë©”ëª¨ë¦¬ ë‚´ "ë°ì´í„°ë² ì´ìŠ¤"</span>
fake_users_db: <span class="hljs-type">List</span>[User] = []
blocklist_token = []
</code></pre>
<div class="content-ad"></div>
<p>ì´ ë¸”ë¡œê·¸ì—ì„œëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤. ìœ„ì˜ ì½”ë“œ ìŠ¤ë‹ˆí«ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, fake_user_dbë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì„¸ë¶€ ì •ë³´ë¥¼ ì €ì¥í•˜ê³ , blocklist_tokenì„ ì‚¬ìš©í•˜ì—¬ ì°¨ë‹¨ëœ í† í°ì„ ì €ì¥í•©ë‹ˆë‹¤.</p>
<h2>schemas.py</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseModel</span>, <span class="hljs-title class_">EmailStr</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCreate</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-attr">username</span>: str
    <span class="hljs-attr">email</span>: <span class="hljs-title class_">EmailStr</span>
    <span class="hljs-attr">password</span>: str

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserResponse</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-attr">username</span>: str
    <span class="hljs-attr">email</span>: str

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Token</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-attr">access_token</span>: str
    <span class="hljs-attr">token_type</span>: str
</code></pre>
<p>ì´ ìŠ¤í‚¤ë§ˆ ëª¨ë¸ì€ ì‚¬ìš©ì ìš”ì²­ ë³¸ë¬¸ì„ ìœ íš¨ì„± ê²€ì‚¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ì ì ˆí•œ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µì„ ì „ì†¡í•©ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<h2>ë‹¨ê³„ 3: ì„¤ì • ìƒìˆ˜</h2>
<h2>constants.py</h2>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">SECRET_KEY</span> = <span class="hljs-string">"your_secret_key"</span>
<span class="hljs-variable constant_">ALGORITHM</span> = <span class="hljs-string">"HS256"</span>
<span class="hljs-variable constant_">ACCESS_TOKEN_EXPIRE_MINUTES</span> = <span class="hljs-number">30</span>
</code></pre>
<ul>
<li>ì´ íŒŒì¼ì€ ì£¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìƒìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
</ul>
<div class="content-ad"></div>
<h2>ë‹¨ê³„ 4: ì¸ì¦ í•¸ë“¤ëŸ¬</h2>
<p>ì´ê²ƒì€ ìš°ë¦¬ì˜ JWT ì¸ì¦ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì´ëŠ” ë¹„ë°€ë²ˆí˜¸ í•´ì‹±, í† í° ìƒì„± ë° ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
<h2>auth.py</h2>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> HTTPException, status
<span class="hljs-keyword">from</span> jose <span class="hljs-keyword">import</span> jwt, JWTError
<span class="hljs-keyword">from</span> passlib.context <span class="hljs-keyword">import</span> CryptContext
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> fake_users_db, blocklist_token
<span class="hljs-keyword">from</span> constants <span class="hljs-keyword">import</span> SECRET_KEY, ALGORITHM
<span class="hljs-keyword">from</span> fastapi.security <span class="hljs-keyword">import</span> HTTPAuthorizationCredentials, HTTPBearer
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Security

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthHandler</span>:
    security = HTTPBearer()
    pwd_context = CryptContext(schemes=[<span class="hljs-string">"bcrypt"</span>], deprecated=<span class="hljs-string">"auto"</span>)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_password</span>(<span class="hljs-params">self, plain_password, hashed_password</span>):
        <span class="hljs-keyword">return</span> self.pwd_context.verify(plain_password, hashed_password)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_password_hash</span>(<span class="hljs-params">self, password</span>):
        <span class="hljs-keyword">return</span> self.pwd_context.<span class="hljs-built_in">hash</span>(password)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_access_token</span>(<span class="hljs-params">self, data: <span class="hljs-built_in">dict</span>, expires_delta: <span class="hljs-type">Optional</span>[timedelta] = <span class="hljs-literal">None</span></span>):
        to_encode = data.copy()
        <span class="hljs-keyword">if</span> expires_delta:
            expire = datetime.utcnow() + expires_delta
        <span class="hljs-keyword">else</span>:
            expire = datetime.utcnow() + timedelta(minutes=<span class="hljs-number">15</span>)
        to_encode.update({<span class="hljs-string">"exp"</span>: expire})
        encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
        <span class="hljs-keyword">return</span> encoded_jwt

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params">self, username: <span class="hljs-built_in">str</span></span>):
        user = <span class="hljs-built_in">next</span>((user <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> fake_users_db <span class="hljs-keyword">if</span> user.username == username), <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">return</span> user

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">authenticate_user</span>(<span class="hljs-params">self, username: <span class="hljs-built_in">str</span>, password: <span class="hljs-built_in">str</span></span>):
        user = <span class="hljs-keyword">await</span> self.get_user(username)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">await</span> self.verify_password(password, user.hashed_password):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> user
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">blocklist_token</span>(<span class="hljs-params">self, token</span>):
        blocklist_token.append(token)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">istokenblock</span>(<span class="hljs-params">self, token</span>):
        <span class="hljs-keyword">return</span> token <span class="hljs-keyword">in</span> blocklist_token

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">auth_wrapper</span>(<span class="hljs-params">self, auth: HTTPAuthorizationCredentials = Security(<span class="hljs-params">security</span>)</span>):
        token = auth.credentials
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token <span class="hljs-keyword">or</span> <span class="hljs-keyword">await</span> self.istokenblock(token):
            <span class="hljs-keyword">raise</span> HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail=<span class="hljs-string">"Not authenticated"</span>,
                headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
            )
        <span class="hljs-keyword">try</span>:
            payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
            username: <span class="hljs-built_in">str</span> = payload.get(<span class="hljs-string">"sub"</span>)
            <span class="hljs-keyword">if</span> username <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">raise</span> HTTPException(
                    status_code=status.HTTP_401_UNAUTHORIZED,
                    detail=<span class="hljs-string">"Not authenticated"</span>,
                    headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
                )
        <span class="hljs-keyword">except</span> JWTError:
            <span class="hljs-keyword">raise</span> HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail=<span class="hljs-string">"Not authenticated"</span>,
                headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
            )
        user = <span class="hljs-keyword">await</span> self.get_user(username)
        <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">raise</span> HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail=<span class="hljs-string">"Not authenticated"</span>,
                headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
            )
        <span class="hljs-keyword">return</span> user
</code></pre>
<div class="content-ad"></div>
<ul>
<li>ì´ê³³ì€ ì¸ì¦ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ verify_password, authenticate_user, blocklist_token ë“±ê³¼ ê°™ì€ ëª¨ë“  ì¤‘ìš”í•œ ê¸°ëŠ¥ì„ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.</li>
</ul>
<h2>ë‹¨ê³„ 5: ì‚¬ìš©ì ë“±ë¡ ë° í† í° ìƒì„±</h2>
<h2>controller.py</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> schemas <span class="hljs-keyword">import</span> <span class="hljs-title class_">UserCreate</span>, <span class="hljs-title class_">UserResponse</span>, <span class="hljs-title class_">Token</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">APIRouter</span>
<span class="hljs-keyword">from</span> auth <span class="hljs-keyword">import</span> <span class="hljs-title class_">AuthHandler</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">APIRouter</span>, <span class="hljs-title class_">Depends</span>, <span class="hljs-title class_">HTTPException</span>, status
<span class="hljs-keyword">from</span> fastapi.<span class="hljs-property">security</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">OAuth2PasswordRequestForm</span>
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> timedelta
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> <span class="hljs-title class_">User</span>, fake_users_db
<span class="hljs-keyword">from</span> constants <span class="hljs-keyword">import</span> <span class="hljs-variable constant_">ACCESS_TOKEN_EXPIRE_MINUTES</span>
<span class="hljs-keyword">from</span> fastapi.<span class="hljs-property">security</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">HTTPAuthorizationCredentials</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">Security</span>


auth_router = <span class="hljs-title class_">APIRouter</span>()
auth_handle = <span class="hljs-title class_">AuthHandler</span>()

@auth_router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/register"</span>, response_model=<span class="hljs-title class_">UserResponse</span>)
<span class="hljs-keyword">async</span> def <span class="hljs-title function_">register_user</span>(<span class="hljs-attr">user</span>: <span class="hljs-title class_">UserCreate</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">get_user</span>(user.<span class="hljs-property">username</span>):
        raise <span class="hljs-title class_">HTTPException</span>(
            status_code=status.<span class="hljs-property">HTTP_400_BAD_REQUEST</span>,
            detail=<span class="hljs-string">"ì´ë¯¸ ë“±ë¡ëœ ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤."</span>,
        )
    hashed_password = <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">get_password_hash</span>(user.<span class="hljs-property">password</span>)
    new_user = <span class="hljs-title class_">User</span>(username=user.<span class="hljs-property">username</span>, email=user.<span class="hljs-property">email</span>, hashed_password=hashed_password)
    fake_users_db.<span class="hljs-title function_">append</span>(new_user)
    <span class="hljs-keyword">return</span> new_user

@auth_router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/token"</span>, response_model=<span class="hljs-title class_">Token</span>)
<span class="hljs-keyword">async</span> def <span class="hljs-title function_">login_for_access_token</span>(<span class="hljs-attr">form_data</span>: <span class="hljs-title class_">OAuth2PasswordRequestForm</span> = <span class="hljs-title class_">Depends</span>()):
    user = <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">authenticate_user</span>(form_data.<span class="hljs-property">username</span>, form_data.<span class="hljs-property">password</span>)
    <span class="hljs-keyword">if</span> not <span class="hljs-attr">user</span>:
        raise <span class="hljs-title class_">HTTPException</span>(
            status_code=status.<span class="hljs-property">HTTP_401_UNAUTHORIZED</span>,
            detail=<span class="hljs-string">"ì˜ëª»ëœ ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤."</span>,
            headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
        )
    access_token_expires = <span class="hljs-title function_">timedelta</span>(minutes=<span class="hljs-variable constant_">ACCESS_TOKEN_EXPIRE_MINUTES</span>)
    access_token = <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">create_access_token</span>(
        data={<span class="hljs-string">"sub"</span>: user.<span class="hljs-property">username</span>}, expires_delta=access_token_expires
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"access_token"</span>: access_token, <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"bearer"</span>}

@auth_router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/logout"</span>)
<span class="hljs-keyword">async</span> def <span class="hljs-title function_">logout_access_token</span>(<span class="hljs-attr">auth</span>: <span class="hljs-title class_">HTTPAuthorizationCredentials</span> = <span class="hljs-title class_">Security</span>(auth_handle.<span class="hljs-property">security</span>)):
    <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">blocklist_token</span>(auth.<span class="hljs-property">credentials</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤."</span>}
</code></pre>
<div class="content-ad"></div>
<p>ì—¬ê¸°ì—ì„œëŠ” ì‚¬ìš©ìë¥¼ ë“±ë¡í•˜ê³  ë¡œê·¸ì¸í•˜ë©° í† í°ì„ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</p>
<h2>ë‹¨ê³„ 6: FastAPIì™€ í†µí•©í•˜ê¸°</h2>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, ëª¨ë“  ê²ƒì„ ì£¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í†µí•©í•˜ì„¸ìš”.</p>
<h2>main.py</h2>
<div class="content-ad"></div>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends
<span class="hljs-keyword">from</span> controller <span class="hljs-keyword">import</span> auth_router
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> auth <span class="hljs-keyword">import</span> AuthHandler

app = FastAPI()
auth_handler = AuthHandler()
app.include_router(auth_router, prefix=<span class="hljs-string">"/auth"</span>, tags=[<span class="hljs-string">"Auth"</span>])

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/auth-test"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_users_me</span>(<span class="hljs-params">current_user: User = Depends(<span class="hljs-params">auth_handler.auth_wrapper</span>)</span>):
    <span class="hljs-keyword">return</span> current_user
</code></pre>
<p>JWT ì¸ì¦ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ë¼ìš°íŠ¸ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</p>
<p>ì—¬ê¸° GitHub ë§í¬ ìˆì–´ìš”!!</p>
<h2>ê²°ë¡ </h2>
<div class="content-ad"></div>
<p>FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì— JWT ì¸ì¦ì„ ì„¤ì •í–ˆêµ°ìš”. ì´ ì„¤ì •ì—ëŠ” ì‚¬ìš©ì ë“±ë¡, JWT í† í° ìƒì„±ì„ ìœ„í•œ ë¡œê·¸ì¸ ë° ë³´í˜¸ëœ ê²½ë¡œë¥¼ ìœ„í•œ í† í° í™•ì¸ì´ í¬í•¨ë˜ì–´ ìˆì–´ìš”. JWTëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë§Œ íŠ¹ì • ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•˜ì—¬ APIë¥¼ ì•ˆì „í•˜ê³  ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
<h2>ì°¸ê³ :</h2>
<ul>
<li><a href="https://fastapi.tiangolo.com/" rel="nofollow" target="_blank">https://fastapi.tiangolo.com/</a></li>
</ul>
<p>ë…ì„œí•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë§Œì•½ ì˜ëª»ëœ ë¶€ë¶„ì´ë‚˜ ë” ì¢‹ì€ ë°©ë²•ì„ ì•Œê³  ê³„ì‹œë‹¤ë©´ ì•„ë˜ ëŒ“ê¸€ì— ì•Œë ¤ì£¼ì„¸ìš”.</p>
<div class="content-ad"></div>
<p>ë§Œì•½ ì´ ê²Œì‹œë¬¼ì´ ë§ˆìŒì— ë“ ë‹¤ë©´ ì•„ë˜ì˜ ğŸ‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ìœ ìš©í•˜ê²Œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì„¸ìš”. ë˜í•œ GitHubì—ì„œ ì €ë¥¼ íŒ”ë¡œìš°í•˜ê³  Linkedinì—ì„œ ì €ì™€ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"ë¹ ë¥¸ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT ì¸ì¦ êµ¬í˜„í•˜ê¸°","description":"","date":"2024-06-20 14:08","slug":"2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication","content":"\n\nì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT (JSON Web Token) ì¸ì¦ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•˜ê² ìŠµë‹ˆë‹¤. JWTëŠ” ë‘ ë‹¹ì‚¬ì ê°„ì— ì£¼ì¥ì„ ë‚˜íƒ€ë‚´ëŠ” ì»´íŒ©íŠ¸í•˜ê³  URL-ì•ˆì „í•œ ìˆ˜ë‹¨ìœ¼ë¡œ, ë³´ì•ˆ ì¸ì¦ì— ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png)\n\n## JWTë€ ë¬´ì—‡ì¸ê°€ìš”?\n\nJWTëŠ” JSON Web Tokenì˜ ì•½ìì…ë‹ˆë‹¤. ì¼ë¶€ ì£¼ì¥ì„ ë‚˜íƒ€ë‚´ëŠ” í† í°ì„ ìƒì„±í•˜ê¸° ìœ„í•œ í‘œì¤€ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í† í°ë“¤ì€ ë¹„ë°€ í‚¤ ë˜ëŠ” ê³µê°œ/ê°œì¸ í‚¤ ìŒìœ¼ë¡œ ì„œëª…ë©ë‹ˆë‹¤. ë‹¤ìŒì€ JWTê°€ ì‘ë™í•˜ëŠ” ê°„ë‹¨í•œ ì„¤ëª…ì…ë‹ˆë‹¤:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- í—¤ë”: ì¼ë°˜ì ìœ¼ë¡œ í† í° ìœ í˜• (JWT)ê³¼ ì„œëª… ì•Œê³ ë¦¬ì¦˜ (ì˜ˆ: HMAC SHA256 ë˜ëŠ” RSA)ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.\n\n```json\n{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n```\n\n- í˜ì´ë¡œë“œ: í´ë ˆì„ì€ ê°œì²´(ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ì)ì— ê´€í•œ ë¬¸ì¥ê³¼ ì¶”ê°€ ë°ì´í„°ì…ë‹ˆë‹¤.\n\n```json\n{\n  \"username\": \"rajan\",\n  \"email\": \"rajan12@rajan.com\"\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- ì„œëª…: ì„œëª… ë¶€ë¶„ì„ ë§Œë“¤ë ¤ë©´ ì¸ì½”ë”©ëœ í—¤ë”, ì¸ì½”ë”©ëœ í˜ì´ë¡œë“œ, ë¹„ë°€í‚¤ ë° í—¤ë”ì—ì„œ ì§€ì •í•œ ì•Œê³ ë¦¬ì¦˜ì„ ê°€ì ¸ ì™€ì•¼ í•©ë‹ˆë‹¤.\n\n```js\n# secret id\nABjhjdsjfsh234fjhuih324$jihdfdshkgsog\n```\n\n## JWTì˜ ì¥ì :\n\n- ê°„ê²°í•¨: JWTëŠ” ê°„ê²°í•˜ë©° URL, POST ë§¤ê°œë³€ìˆ˜ ë˜ëŠ” HTTP í—¤ë” ì•ˆì— ì „ì†¡í•  ìˆ˜ ìˆì–´ ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©í•©ë‹ˆë‹¤.\n- ìì²´ í¬í•¨: í˜ì´ë¡œë“œì—ëŠ” ì¸ì¦ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆì–´ ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## FastAPIì—ì„œì˜ ë‹¨ê³„ë³„ êµ¬í˜„\n\n## ë‹¨ê³„ 1: ì˜ì¡´ì„± ì„¤ì •\n\në¨¼ì €, FastAPIì™€ ê´€ë ¨ ì˜ì¡´ì„±ì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:\n\n```js\npip install fastapi \npip install passlib \npip install python-jose\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## ë‹¨ê³„ 2: ëª¨ë¸ ë° ìŠ¤í‚¤ë§ˆ ì •ì˜\n\nì‚¬ìš©ì ëª¨ë¸ê³¼ ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•  ê²ƒì…ë‹ˆë‹¤.\n\n## models.py\n\n```python\n# models.py\n\nfrom pydantic import BaseModel\nfrom typing import List\n\nclass User(BaseModel):\n    username: str\n    email: str\n    hashed_password: str\n\n# ë©”ëª¨ë¦¬ ë‚´ \"ë°ì´í„°ë² ì´ìŠ¤\"\nfake_users_db: List[User] = []\nblocklist_token = []\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì´ ë¸”ë¡œê·¸ì—ì„œëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤. ìœ„ì˜ ì½”ë“œ ìŠ¤ë‹ˆí«ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, fake_user_dbë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì„¸ë¶€ ì •ë³´ë¥¼ ì €ì¥í•˜ê³ , blocklist_tokenì„ ì‚¬ìš©í•˜ì—¬ ì°¨ë‹¨ëœ í† í°ì„ ì €ì¥í•©ë‹ˆë‹¤.\n\n## schemas.py\n\n```js\nfrom pydantic import BaseModel, EmailStr\n\nclass UserCreate(BaseModel):\n    username: str\n    email: EmailStr\n    password: str\n\nclass UserResponse(BaseModel):\n    username: str\n    email: str\n\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n```\n\nì´ ìŠ¤í‚¤ë§ˆ ëª¨ë¸ì€ ì‚¬ìš©ì ìš”ì²­ ë³¸ë¬¸ì„ ìœ íš¨ì„± ê²€ì‚¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ì ì ˆí•œ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µì„ ì „ì†¡í•©ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## ë‹¨ê³„ 3: ì„¤ì • ìƒìˆ˜\n\n## constants.py\n\n```js\nSECRET_KEY = \"your_secret_key\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n```\n\n- ì´ íŒŒì¼ì€ ì£¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìƒìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## ë‹¨ê³„ 4: ì¸ì¦ í•¸ë“¤ëŸ¬\n\nì´ê²ƒì€ ìš°ë¦¬ì˜ JWT ì¸ì¦ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì´ëŠ” ë¹„ë°€ë²ˆí˜¸ í•´ì‹±, í† í° ìƒì„± ë° ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\n\n## auth.py\n\n```python\nfrom fastapi import HTTPException, status\nfrom jose import jwt, JWTError\nfrom passlib.context import CryptContext\nfrom datetime import datetime, timedelta\nfrom typing import Optional\nfrom models import fake_users_db, blocklist_token\nfrom constants import SECRET_KEY, ALGORITHM\nfrom fastapi.security import HTTPAuthorizationCredentials, HTTPBearer\nfrom fastapi import Security\n\nclass AuthHandler:\n    security = HTTPBearer()\n    pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n\n    async def verify_password(self, plain_password, hashed_password):\n        return self.pwd_context.verify(plain_password, hashed_password)\n\n    async def get_password_hash(self, password):\n        return self.pwd_context.hash(password)\n\n    async def create_access_token(self, data: dict, expires_delta: Optional[timedelta] = None):\n        to_encode = data.copy()\n        if expires_delta:\n            expire = datetime.utcnow() + expires_delta\n        else:\n            expire = datetime.utcnow() + timedelta(minutes=15)\n        to_encode.update({\"exp\": expire})\n        encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n        return encoded_jwt\n\n    async def get_user(self, username: str):\n        user = next((user for user in fake_users_db if user.username == username), None)\n        return user\n\n    async def authenticate_user(self, username: str, password: str):\n        user = await self.get_user(username)\n        if not user:\n            return False\n        if not await self.verify_password(password, user.hashed_password):\n            return False\n        return user\n    \n    async def blocklist_token(self, token):\n        blocklist_token.append(token)\n\n    async def istokenblock(self, token):\n        return token in blocklist_token\n\n    async def auth_wrapper(self, auth: HTTPAuthorizationCredentials = Security(security)):\n        token = auth.credentials\n        if not token or await self.istokenblock(token):\n            raise HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\"Not authenticated\",\n                headers={\"WWW-Authenticate\": \"Bearer\"},\n            )\n        try:\n            payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n            username: str = payload.get(\"sub\")\n            if username is None:\n                raise HTTPException(\n                    status_code=status.HTTP_401_UNAUTHORIZED,\n                    detail=\"Not authenticated\",\n                    headers={\"WWW-Authenticate\": \"Bearer\"},\n                )\n        except JWTError:\n            raise HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\"Not authenticated\",\n                headers={\"WWW-Authenticate\": \"Bearer\"},\n            )\n        user = await self.get_user(username)\n        if user is None:\n            raise HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\"Not authenticated\",\n                headers={\"WWW-Authenticate\": \"Bearer\"},\n            )\n        return user\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- ì´ê³³ì€ ì¸ì¦ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ verify_password, authenticate_user, blocklist_token ë“±ê³¼ ê°™ì€ ëª¨ë“  ì¤‘ìš”í•œ ê¸°ëŠ¥ì„ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.\n\n## ë‹¨ê³„ 5: ì‚¬ìš©ì ë“±ë¡ ë° í† í° ìƒì„±\n\n## controller.py\n\n```js\nfrom schemas import UserCreate, UserResponse, Token\nfrom fastapi import APIRouter\nfrom auth import AuthHandler\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom fastapi.security import OAuth2PasswordRequestForm\nfrom datetime import timedelta\nfrom models import User, fake_users_db\nfrom constants import ACCESS_TOKEN_EXPIRE_MINUTES\nfrom fastapi.security import HTTPAuthorizationCredentials\nfrom fastapi import Security\n\n\nauth_router = APIRouter()\nauth_handle = AuthHandler()\n\n@auth_router.post(\"/register\", response_model=UserResponse)\nasync def register_user(user: UserCreate):\n    if await auth_handle.get_user(user.username):\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"ì´ë¯¸ ë“±ë¡ëœ ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.\",\n        )\n    hashed_password = await auth_handle.get_password_hash(user.password)\n    new_user = User(username=user.username, email=user.email, hashed_password=hashed_password)\n    fake_users_db.append(new_user)\n    return new_user\n\n@auth_router.post(\"/token\", response_model=Token)\nasync def login_for_access_token(form_data: OAuth2PasswordRequestForm = Depends()):\n    user = await auth_handle.authenticate_user(form_data.username, form_data.password)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"ì˜ëª»ëœ ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\n    access_token = await auth_handle.create_access_token(\n        data={\"sub\": user.username}, expires_delta=access_token_expires\n    )\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n\n@auth_router.post(\"/logout\")\nasync def logout_access_token(auth: HTTPAuthorizationCredentials = Security(auth_handle.security)):\n    await auth_handle.blocklist_token(auth.credentials)\n    return {\"message\": \"ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.\"}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì—¬ê¸°ì—ì„œëŠ” ì‚¬ìš©ìë¥¼ ë“±ë¡í•˜ê³  ë¡œê·¸ì¸í•˜ë©° í† í°ì„ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.\n\n## ë‹¨ê³„ 6: FastAPIì™€ í†µí•©í•˜ê¸°\n\në§ˆì§€ë§‰ìœ¼ë¡œ, ëª¨ë“  ê²ƒì„ ì£¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í†µí•©í•˜ì„¸ìš”.\n\n## main.py\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```python\nfrom fastapi import FastAPI, Depends\nfrom controller import auth_router\nfrom models import User\nfrom auth import AuthHandler\n\napp = FastAPI()\nauth_handler = AuthHandler()\napp.include_router(auth_router, prefix=\"/auth\", tags=[\"Auth\"])\n\n@app.get(\"/auth-test\")\nasync def read_users_me(current_user: User = Depends(auth_handler.auth_wrapper)):\n    return current_user\n```\n\nJWT ì¸ì¦ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ë¼ìš°íŠ¸ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.\n\nì—¬ê¸° GitHub ë§í¬ ìˆì–´ìš”!!\n\n## ê²°ë¡ \n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nFastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì— JWT ì¸ì¦ì„ ì„¤ì •í–ˆêµ°ìš”. ì´ ì„¤ì •ì—ëŠ” ì‚¬ìš©ì ë“±ë¡, JWT í† í° ìƒì„±ì„ ìœ„í•œ ë¡œê·¸ì¸ ë° ë³´í˜¸ëœ ê²½ë¡œë¥¼ ìœ„í•œ í† í° í™•ì¸ì´ í¬í•¨ë˜ì–´ ìˆì–´ìš”. JWTëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë§Œ íŠ¹ì • ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•˜ì—¬ APIë¥¼ ì•ˆì „í•˜ê³  ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.\n\n## ì°¸ê³ :\n\n- https://fastapi.tiangolo.com/\n\në…ì„œí•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë§Œì•½ ì˜ëª»ëœ ë¶€ë¶„ì´ë‚˜ ë” ì¢‹ì€ ë°©ë²•ì„ ì•Œê³  ê³„ì‹œë‹¤ë©´ ì•„ë˜ ëŒ“ê¸€ì— ì•Œë ¤ì£¼ì„¸ìš”.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\në§Œì•½ ì´ ê²Œì‹œë¬¼ì´ ë§ˆìŒì— ë“ ë‹¤ë©´ ì•„ë˜ì˜ ğŸ‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ìœ ìš©í•˜ê²Œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì„¸ìš”. ë˜í•œ GitHubì—ì„œ ì €ë¥¼ íŒ”ë¡œìš°í•˜ê³  Linkedinì—ì„œ ì €ì™€ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.","ogImage":{"url":"/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png"},"coverImage":"/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png","tag":["Tech"],"readingTime":9},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003eì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JWT (JSON Web Token) ì¸ì¦ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•˜ê² ìŠµë‹ˆë‹¤. JWTëŠ” ë‘ ë‹¹ì‚¬ì ê°„ì— ì£¼ì¥ì„ ë‚˜íƒ€ë‚´ëŠ” ì»´íŒ©íŠ¸í•˜ê³  URL-ì•ˆì „í•œ ìˆ˜ë‹¨ìœ¼ë¡œ, ë³´ì•ˆ ì¸ì¦ì— ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png\" alt=\"ì´ë¯¸ì§€\"\u003e\u003c/p\u003e\n\u003ch2\u003eJWTë€ ë¬´ì—‡ì¸ê°€ìš”?\u003c/h2\u003e\n\u003cp\u003eJWTëŠ” JSON Web Tokenì˜ ì•½ìì…ë‹ˆë‹¤. ì¼ë¶€ ì£¼ì¥ì„ ë‚˜íƒ€ë‚´ëŠ” í† í°ì„ ìƒì„±í•˜ê¸° ìœ„í•œ í‘œì¤€ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í† í°ë“¤ì€ ë¹„ë°€ í‚¤ ë˜ëŠ” ê³µê°œ/ê°œì¸ í‚¤ ìŒìœ¼ë¡œ ì„œëª…ë©ë‹ˆë‹¤. ë‹¤ìŒì€ JWTê°€ ì‘ë™í•˜ëŠ” ê°„ë‹¨í•œ ì„¤ëª…ì…ë‹ˆë‹¤:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eí—¤ë”: ì¼ë°˜ì ìœ¼ë¡œ í† í° ìœ í˜• (JWT)ê³¼ ì„œëª… ì•Œê³ ë¦¬ì¦˜ (ì˜ˆ: HMAC SHA256 ë˜ëŠ” RSA)ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"alg\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"HS256\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"typ\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"JWT\"\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eí˜ì´ë¡œë“œ: í´ë ˆì„ì€ ê°œì²´(ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ì)ì— ê´€í•œ ë¬¸ì¥ê³¼ ì¶”ê°€ ë°ì´í„°ì…ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"username\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"rajan\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"email\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"rajan12@rajan.com\"\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eì„œëª…: ì„œëª… ë¶€ë¶„ì„ ë§Œë“¤ë ¤ë©´ ì¸ì½”ë”©ëœ í—¤ë”, ì¸ì½”ë”©ëœ í˜ì´ë¡œë“œ, ë¹„ë°€í‚¤ ë° í—¤ë”ì—ì„œ ì§€ì •í•œ ì•Œê³ ë¦¬ì¦˜ì„ ê°€ì ¸ ì™€ì•¼ í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# secret id\n\u003cspan class=\"hljs-title class_\"\u003eABjhjdsjfsh234\u003c/span\u003efjhuih324$jihdfdshkgsog\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eJWTì˜ ì¥ì :\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eê°„ê²°í•¨: JWTëŠ” ê°„ê²°í•˜ë©° URL, POST ë§¤ê°œë³€ìˆ˜ ë˜ëŠ” HTTP í—¤ë” ì•ˆì— ì „ì†¡í•  ìˆ˜ ìˆì–´ ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eìì²´ í¬í•¨: í˜ì´ë¡œë“œì—ëŠ” ì¸ì¦ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆì–´ ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003eFastAPIì—ì„œì˜ ë‹¨ê³„ë³„ êµ¬í˜„\u003c/h2\u003e\n\u003ch2\u003eë‹¨ê³„ 1: ì˜ì¡´ì„± ì„¤ì •\u003c/h2\u003e\n\u003cp\u003eë¨¼ì €, FastAPIì™€ ê´€ë ¨ ì˜ì¡´ì„±ì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epip install fastapi \npip install passlib \npip install python-jose\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003eë‹¨ê³„ 2: ëª¨ë¸ ë° ìŠ¤í‚¤ë§ˆ ì •ì˜\u003c/h2\u003e\n\u003cp\u003eì‚¬ìš©ì ëª¨ë¸ê³¼ ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•  ê²ƒì…ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch2\u003emodels.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# models.py\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pydantic \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e BaseModel\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e typing \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eList\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e(\u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseModel\u003c/span\u003e):\n    username: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\n    email: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\n    hashed_password: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# ë©”ëª¨ë¦¬ ë‚´ \"ë°ì´í„°ë² ì´ìŠ¤\"\u003c/span\u003e\nfake_users_db: \u003cspan class=\"hljs-type\"\u003eList\u003c/span\u003e[User] = []\nblocklist_token = []\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì´ ë¸”ë¡œê·¸ì—ì„œëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤. ìœ„ì˜ ì½”ë“œ ìŠ¤ë‹ˆí«ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, fake_user_dbë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì„¸ë¶€ ì •ë³´ë¥¼ ì €ì¥í•˜ê³ , blocklist_tokenì„ ì‚¬ìš©í•˜ì—¬ ì°¨ë‹¨ëœ í† í°ì„ ì €ì¥í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch2\u003eschemas.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pydantic \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eEmailStr\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserCreate\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003eusername\u003c/span\u003e: str\n    \u003cspan class=\"hljs-attr\"\u003eemail\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eEmailStr\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003epassword\u003c/span\u003e: str\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserResponse\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003eusername\u003c/span\u003e: str\n    \u003cspan class=\"hljs-attr\"\u003eemail\u003c/span\u003e: str\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eToken\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003eaccess_token\u003c/span\u003e: str\n    \u003cspan class=\"hljs-attr\"\u003etoken_type\u003c/span\u003e: str\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì´ ìŠ¤í‚¤ë§ˆ ëª¨ë¸ì€ ì‚¬ìš©ì ìš”ì²­ ë³¸ë¬¸ì„ ìœ íš¨ì„± ê²€ì‚¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ì ì ˆí•œ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µì„ ì „ì†¡í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003eë‹¨ê³„ 3: ì„¤ì • ìƒìˆ˜\u003c/h2\u003e\n\u003ch2\u003econstants.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eSECRET_KEY\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"your_secret_key\"\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eALGORITHM\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"HS256\"\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eACCESS_TOKEN_EXPIRE_MINUTES\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eì´ íŒŒì¼ì€ ì£¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìƒìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003eë‹¨ê³„ 4: ì¸ì¦ í•¸ë“¤ëŸ¬\u003c/h2\u003e\n\u003cp\u003eì´ê²ƒì€ ìš°ë¦¬ì˜ JWT ì¸ì¦ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì´ëŠ” ë¹„ë°€ë²ˆí˜¸ í•´ì‹±, í† í° ìƒì„± ë° ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch2\u003eauth.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e HTTPException, status\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e jose \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e jwt, JWTError\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e passlib.context \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e CryptContext\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e datetime \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e datetime, timedelta\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e typing \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eOptional\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e models \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fake_users_db, blocklist_token\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e constants \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e SECRET_KEY, ALGORITHM\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi.security \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e HTTPAuthorizationCredentials, HTTPBearer\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Security\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAuthHandler\u003c/span\u003e:\n    security = HTTPBearer()\n    pwd_context = CryptContext(schemes=[\u003cspan class=\"hljs-string\"\u003e\"bcrypt\"\u003c/span\u003e], deprecated=\u003cspan class=\"hljs-string\"\u003e\"auto\"\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003everify_password\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, plain_password, hashed_password\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.pwd_context.verify(plain_password, hashed_password)\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_password_hash\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, password\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.pwd_context.\u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e(password)\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreate_access_token\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, data: \u003cspan class=\"hljs-built_in\"\u003edict\u003c/span\u003e, expires_delta: \u003cspan class=\"hljs-type\"\u003eOptional\u003c/span\u003e[timedelta] = \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e\u003c/span\u003e):\n        to_encode = data.copy()\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e expires_delta:\n            expire = datetime.utcnow() + expires_delta\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n            expire = datetime.utcnow() + timedelta(minutes=\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e)\n        to_encode.update({\u003cspan class=\"hljs-string\"\u003e\"exp\"\u003c/span\u003e: expire})\n        encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e encoded_jwt\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_user\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, username: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\u003c/span\u003e):\n        user = \u003cspan class=\"hljs-built_in\"\u003enext\u003c/span\u003e((user \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e fake_users_db \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e user.username == username), \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e user\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eauthenticate_user\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, username: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e, password: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\u003c/span\u003e):\n        user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e self.get_user(username)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e user:\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eFalse\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e self.verify_password(password, user.hashed_password):\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eFalse\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e user\n    \n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eblocklist_token\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, token\u003c/span\u003e):\n        blocklist_token.append(token)\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eistokenblock\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, token\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e token \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e blocklist_token\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eauth_wrapper\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, auth: HTTPAuthorizationCredentials = Security(\u003cspan class=\"hljs-params\"\u003esecurity\u003c/span\u003e)\u003c/span\u003e):\n        token = auth.credentials\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e token \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e self.istokenblock(token):\n            \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\u003cspan class=\"hljs-string\"\u003e\"Not authenticated\"\u003c/span\u003e,\n                headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n            )\n        \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e:\n            payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n            username: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e = payload.get(\u003cspan class=\"hljs-string\"\u003e\"sub\"\u003c/span\u003e)\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e username \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n                \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(\n                    status_code=status.HTTP_401_UNAUTHORIZED,\n                    detail=\u003cspan class=\"hljs-string\"\u003e\"Not authenticated\"\u003c/span\u003e,\n                    headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n                )\n        \u003cspan class=\"hljs-keyword\"\u003eexcept\u003c/span\u003e JWTError:\n            \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\u003cspan class=\"hljs-string\"\u003e\"Not authenticated\"\u003c/span\u003e,\n                headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n            )\n        user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e self.get_user(username)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e user \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\u003cspan class=\"hljs-string\"\u003e\"Not authenticated\"\u003c/span\u003e,\n                headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n            )\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e user\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eì´ê³³ì€ ì¸ì¦ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ verify_password, authenticate_user, blocklist_token ë“±ê³¼ ê°™ì€ ëª¨ë“  ì¤‘ìš”í•œ ê¸°ëŠ¥ì„ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eë‹¨ê³„ 5: ì‚¬ìš©ì ë“±ë¡ ë° í† í° ìƒì„±\u003c/h2\u003e\n\u003ch2\u003econtroller.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e schemas \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserCreate\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eUserResponse\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eToken\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAPIRouter\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e auth \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAuthHandler\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAPIRouter\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eDepends\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e, status\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi.\u003cspan class=\"hljs-property\"\u003esecurity\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eOAuth2PasswordRequestForm\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e datetime \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e timedelta\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e models \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e, fake_users_db\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e constants \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eACCESS_TOKEN_EXPIRE_MINUTES\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi.\u003cspan class=\"hljs-property\"\u003esecurity\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHTTPAuthorizationCredentials\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSecurity\u003c/span\u003e\n\n\nauth_router = \u003cspan class=\"hljs-title class_\"\u003eAPIRouter\u003c/span\u003e()\nauth_handle = \u003cspan class=\"hljs-title class_\"\u003eAuthHandler\u003c/span\u003e()\n\n@auth_router.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/register\"\u003c/span\u003e, response_model=\u003cspan class=\"hljs-title class_\"\u003eUserResponse\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"hljs-title function_\"\u003eregister_user\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eUserCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003eget_user\u003c/span\u003e(user.\u003cspan class=\"hljs-property\"\u003eusername\u003c/span\u003e):\n        raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(\n            status_code=status.\u003cspan class=\"hljs-property\"\u003eHTTP_400_BAD_REQUEST\u003c/span\u003e,\n            detail=\u003cspan class=\"hljs-string\"\u003e\"ì´ë¯¸ ë“±ë¡ëœ ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.\"\u003c/span\u003e,\n        )\n    hashed_password = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003eget_password_hash\u003c/span\u003e(user.\u003cspan class=\"hljs-property\"\u003epassword\u003c/span\u003e)\n    new_user = \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e(username=user.\u003cspan class=\"hljs-property\"\u003eusername\u003c/span\u003e, email=user.\u003cspan class=\"hljs-property\"\u003eemail\u003c/span\u003e, hashed_password=hashed_password)\n    fake_users_db.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(new_user)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e new_user\n\n@auth_router.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/token\"\u003c/span\u003e, response_model=\u003cspan class=\"hljs-title class_\"\u003eToken\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"hljs-title function_\"\u003elogin_for_access_token\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003eform_data\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eOAuth2PasswordRequestForm\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eDepends\u003c/span\u003e()):\n    user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003eauthenticate_user\u003c/span\u003e(form_data.\u003cspan class=\"hljs-property\"\u003eusername\u003c/span\u003e, form_data.\u003cspan class=\"hljs-property\"\u003epassword\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e not \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e:\n        raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(\n            status_code=status.\u003cspan class=\"hljs-property\"\u003eHTTP_401_UNAUTHORIZED\u003c/span\u003e,\n            detail=\u003cspan class=\"hljs-string\"\u003e\"ì˜ëª»ëœ ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.\"\u003c/span\u003e,\n            headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n        )\n    access_token_expires = \u003cspan class=\"hljs-title function_\"\u003etimedelta\u003c/span\u003e(minutes=\u003cspan class=\"hljs-variable constant_\"\u003eACCESS_TOKEN_EXPIRE_MINUTES\u003c/span\u003e)\n    access_token = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003ecreate_access_token\u003c/span\u003e(\n        data={\u003cspan class=\"hljs-string\"\u003e\"sub\"\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003eusername\u003c/span\u003e}, expires_delta=access_token_expires\n    )\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-string\"\u003e\"access_token\"\u003c/span\u003e: access_token, \u003cspan class=\"hljs-string\"\u003e\"token_type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"bearer\"\u003c/span\u003e}\n\n@auth_router.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/logout\"\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"hljs-title function_\"\u003elogout_access_token\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003eauth\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eHTTPAuthorizationCredentials\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eSecurity\u003c/span\u003e(auth_handle.\u003cspan class=\"hljs-property\"\u003esecurity\u003c/span\u003e)):\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003eblocklist_token\u003c/span\u003e(auth.\u003cspan class=\"hljs-property\"\u003ecredentials\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.\"\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì—¬ê¸°ì—ì„œëŠ” ì‚¬ìš©ìë¥¼ ë“±ë¡í•˜ê³  ë¡œê·¸ì¸í•˜ë©° í† í°ì„ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch2\u003eë‹¨ê³„ 6: FastAPIì™€ í†µí•©í•˜ê¸°\u003c/h2\u003e\n\u003cp\u003eë§ˆì§€ë§‰ìœ¼ë¡œ, ëª¨ë“  ê²ƒì„ ì£¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í†µí•©í•˜ì„¸ìš”.\u003c/p\u003e\n\u003ch2\u003emain.py\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e FastAPI, Depends\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e controller \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e auth_router\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e models \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e User\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e auth \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e AuthHandler\n\napp = FastAPI()\nauth_handler = AuthHandler()\napp.include_router(auth_router, prefix=\u003cspan class=\"hljs-string\"\u003e\"/auth\"\u003c/span\u003e, tags=[\u003cspan class=\"hljs-string\"\u003e\"Auth\"\u003c/span\u003e])\n\n\u003cspan class=\"hljs-meta\"\u003e@app.get(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/auth-test\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eread_users_me\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecurrent_user: User = Depends(\u003cspan class=\"hljs-params\"\u003eauth_handler.auth_wrapper\u003c/span\u003e)\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e current_user\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eJWT ì¸ì¦ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ë¼ìš°íŠ¸ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eì—¬ê¸° GitHub ë§í¬ ìˆì–´ìš”!!\u003c/p\u003e\n\u003ch2\u003eê²°ë¡ \u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eFastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì— JWT ì¸ì¦ì„ ì„¤ì •í–ˆêµ°ìš”. ì´ ì„¤ì •ì—ëŠ” ì‚¬ìš©ì ë“±ë¡, JWT í† í° ìƒì„±ì„ ìœ„í•œ ë¡œê·¸ì¸ ë° ë³´í˜¸ëœ ê²½ë¡œë¥¼ ìœ„í•œ í† í° í™•ì¸ì´ í¬í•¨ë˜ì–´ ìˆì–´ìš”. JWTëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë§Œ íŠ¹ì • ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•˜ì—¬ APIë¥¼ ì•ˆì „í•˜ê³  ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch2\u003eì°¸ê³ :\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://fastapi.tiangolo.com/\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://fastapi.tiangolo.com/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eë…ì„œí•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë§Œì•½ ì˜ëª»ëœ ë¶€ë¶„ì´ë‚˜ ë” ì¢‹ì€ ë°©ë²•ì„ ì•Œê³  ê³„ì‹œë‹¤ë©´ ì•„ë˜ ëŒ“ê¸€ì— ì•Œë ¤ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eë§Œì•½ ì´ ê²Œì‹œë¬¼ì´ ë§ˆìŒì— ë“ ë‹¤ë©´ ì•„ë˜ì˜ ğŸ‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ìœ ìš©í•˜ê²Œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì„¸ìš”. ë˜í•œ GitHubì—ì„œ ì €ë¥¼ íŒ”ë¡œìš°í•˜ê³  Linkedinì—ì„œ ì €ì™€ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication"},"buildId":"9ddMoNNI_mr3kv4sKx3b_","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>