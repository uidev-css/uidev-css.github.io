<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>빠른 FastAPI 애플리케이션에서 JWT 인증 구현하기 | uidev-css</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://uidev-css.github.io///post/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="빠른 FastAPI 애플리케이션에서 JWT 인증 구현하기 | uidev-css" data-gatsby-head="true"/><meta property="og:title" content="빠른 FastAPI 애플리케이션에서 JWT 인증 구현하기 | uidev-css" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://uidev-css.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://uidev-css.github.io///post/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication" data-gatsby-head="true"/><meta name="twitter:title" content="빠른 FastAPI 애플리케이션에서 JWT 인증 구현하기 | uidev-css" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | uidev-css" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-20 14:08" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b4eed7811784bdd3.js" defer=""></script><script src="/_next/static/9ddMoNNI_mr3kv4sKx3b_/_buildManifest.js" defer=""></script><script src="/_next/static/9ddMoNNI_mr3kv4sKx3b_/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UIDEV CSS</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">빠른 FastAPI 애플리케이션에서 JWT 인증 구현하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="빠른 FastAPI 애플리케이션에서 JWT 인증 구현하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UIDEV CSS</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 20, 2024</span><span class="posts_reading_time__f7YPP">9<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>이 블로그 포스트에서는 FastAPI 애플리케이션에서 JWT (JSON Web Token) 인증을 구현하는 방법을 안내하겠습니다. JWT는 두 당사자 간에 주장을 나타내는 컴팩트하고 URL-안전한 수단으로, 보안 인증에 일반적으로 사용됩니다.</p>
<p><img src="/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png" alt="이미지"></p>
<h2>JWT란 무엇인가요?</h2>
<p>JWT는 JSON Web Token의 약자입니다. 일부 주장을 나타내는 토큰을 생성하기 위한 표준입니다. 이러한 토큰들은 비밀 키 또는 공개/개인 키 쌍으로 서명됩니다. 다음은 JWT가 작동하는 간단한 설명입니다:</p>
<div class="content-ad"></div>
<ul>
<li>헤더: 일반적으로 토큰 유형 (JWT)과 서명 알고리즘 (예: HMAC SHA256 또는 RSA)으로 구성됩니다.</li>
</ul>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"alg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"HS256"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"typ"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JWT"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>페이로드: 클레임은 개체(일반적으로 사용자)에 관한 문장과 추가 데이터입니다.</li>
</ul>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rajan"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rajan12@rajan.com"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<div class="content-ad"></div>
<ul>
<li>서명: 서명 부분을 만들려면 인코딩된 헤더, 인코딩된 페이로드, 비밀키 및 헤더에서 지정한 알고리즘을 가져 와야 합니다.</li>
</ul>
<pre><code class="hljs language-js"># secret id
<span class="hljs-title class_">ABjhjdsjfsh234</span>fjhuih324$jihdfdshkgsog
</code></pre>
<h2>JWT의 장점:</h2>
<ul>
<li>간결함: JWT는 간결하며 URL, POST 매개변수 또는 HTTP 헤더 안에 전송할 수 있어 모바일 애플리케이션에 적합합니다.</li>
<li>자체 포함: 페이로드에는 인증에 필요한 모든 정보가 포함되어 있어 여러 개의 데이터베이스 쿼리가 필요하지 않습니다.</li>
</ul>
<div class="content-ad"></div>
<h2>FastAPI에서의 단계별 구현</h2>
<h2>단계 1: 의존성 설정</h2>
<p>먼저, FastAPI와 관련 의존성이 설치되어 있는지 확인하세요:</p>
<pre><code class="hljs language-js">pip install fastapi 
pip install passlib 
pip install python-jose
</code></pre>
<div class="content-ad"></div>
<h2>단계 2: 모델 및 스키마 정의</h2>
<p>사용자 모델과 요청/응답 스키마를 정의할 것입니다.</p>
<h2>models.py</h2>
<pre><code class="hljs language-python"><span class="hljs-comment"># models.py</span>

<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    username: <span class="hljs-built_in">str</span>
    email: <span class="hljs-built_in">str</span>
    hashed_password: <span class="hljs-built_in">str</span>

<span class="hljs-comment"># 메모리 내 "데이터베이스"</span>
fake_users_db: <span class="hljs-type">List</span>[User] = []
blocklist_token = []
</code></pre>
<div class="content-ad"></div>
<p>이 블로그에서는 데이터를 메모리에 저장합니다. 위의 코드 스니펫에서 볼 수 있듯이, fake_user_db를 사용하여 사용자 세부 정보를 저장하고, blocklist_token을 사용하여 차단된 토큰을 저장합니다.</p>
<h2>schemas.py</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseModel</span>, <span class="hljs-title class_">EmailStr</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCreate</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-attr">username</span>: str
    <span class="hljs-attr">email</span>: <span class="hljs-title class_">EmailStr</span>
    <span class="hljs-attr">password</span>: str

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserResponse</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-attr">username</span>: str
    <span class="hljs-attr">email</span>: str

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Token</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-attr">access_token</span>: str
    <span class="hljs-attr">token_type</span>: str
</code></pre>
<p>이 스키마 모델은 사용자 요청 본문을 유효성 검사하는 데 사용되며, 적절한 형식으로 응답을 전송합니다.</p>
<div class="content-ad"></div>
<h2>단계 3: 설정 상수</h2>
<h2>constants.py</h2>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">SECRET_KEY</span> = <span class="hljs-string">"your_secret_key"</span>
<span class="hljs-variable constant_">ALGORITHM</span> = <span class="hljs-string">"HS256"</span>
<span class="hljs-variable constant_">ACCESS_TOKEN_EXPIRE_MINUTES</span> = <span class="hljs-number">30</span>
</code></pre>
<ul>
<li>이 파일은 주로 애플리케이션에 상수를 정의하는 데 사용됩니다.</li>
</ul>
<div class="content-ad"></div>
<h2>단계 4: 인증 핸들러</h2>
<p>이것은 우리의 JWT 인증의 핵심입니다. 이는 비밀번호 해싱, 토큰 생성 및 사용자 인증을 처리합니다.</p>
<h2>auth.py</h2>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> HTTPException, status
<span class="hljs-keyword">from</span> jose <span class="hljs-keyword">import</span> jwt, JWTError
<span class="hljs-keyword">from</span> passlib.context <span class="hljs-keyword">import</span> CryptContext
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> fake_users_db, blocklist_token
<span class="hljs-keyword">from</span> constants <span class="hljs-keyword">import</span> SECRET_KEY, ALGORITHM
<span class="hljs-keyword">from</span> fastapi.security <span class="hljs-keyword">import</span> HTTPAuthorizationCredentials, HTTPBearer
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Security

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthHandler</span>:
    security = HTTPBearer()
    pwd_context = CryptContext(schemes=[<span class="hljs-string">"bcrypt"</span>], deprecated=<span class="hljs-string">"auto"</span>)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_password</span>(<span class="hljs-params">self, plain_password, hashed_password</span>):
        <span class="hljs-keyword">return</span> self.pwd_context.verify(plain_password, hashed_password)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_password_hash</span>(<span class="hljs-params">self, password</span>):
        <span class="hljs-keyword">return</span> self.pwd_context.<span class="hljs-built_in">hash</span>(password)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_access_token</span>(<span class="hljs-params">self, data: <span class="hljs-built_in">dict</span>, expires_delta: <span class="hljs-type">Optional</span>[timedelta] = <span class="hljs-literal">None</span></span>):
        to_encode = data.copy()
        <span class="hljs-keyword">if</span> expires_delta:
            expire = datetime.utcnow() + expires_delta
        <span class="hljs-keyword">else</span>:
            expire = datetime.utcnow() + timedelta(minutes=<span class="hljs-number">15</span>)
        to_encode.update({<span class="hljs-string">"exp"</span>: expire})
        encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
        <span class="hljs-keyword">return</span> encoded_jwt

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params">self, username: <span class="hljs-built_in">str</span></span>):
        user = <span class="hljs-built_in">next</span>((user <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> fake_users_db <span class="hljs-keyword">if</span> user.username == username), <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">return</span> user

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">authenticate_user</span>(<span class="hljs-params">self, username: <span class="hljs-built_in">str</span>, password: <span class="hljs-built_in">str</span></span>):
        user = <span class="hljs-keyword">await</span> self.get_user(username)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">await</span> self.verify_password(password, user.hashed_password):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> user
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">blocklist_token</span>(<span class="hljs-params">self, token</span>):
        blocklist_token.append(token)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">istokenblock</span>(<span class="hljs-params">self, token</span>):
        <span class="hljs-keyword">return</span> token <span class="hljs-keyword">in</span> blocklist_token

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">auth_wrapper</span>(<span class="hljs-params">self, auth: HTTPAuthorizationCredentials = Security(<span class="hljs-params">security</span>)</span>):
        token = auth.credentials
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token <span class="hljs-keyword">or</span> <span class="hljs-keyword">await</span> self.istokenblock(token):
            <span class="hljs-keyword">raise</span> HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail=<span class="hljs-string">"Not authenticated"</span>,
                headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
            )
        <span class="hljs-keyword">try</span>:
            payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
            username: <span class="hljs-built_in">str</span> = payload.get(<span class="hljs-string">"sub"</span>)
            <span class="hljs-keyword">if</span> username <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">raise</span> HTTPException(
                    status_code=status.HTTP_401_UNAUTHORIZED,
                    detail=<span class="hljs-string">"Not authenticated"</span>,
                    headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
                )
        <span class="hljs-keyword">except</span> JWTError:
            <span class="hljs-keyword">raise</span> HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail=<span class="hljs-string">"Not authenticated"</span>,
                headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
            )
        user = <span class="hljs-keyword">await</span> self.get_user(username)
        <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">raise</span> HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail=<span class="hljs-string">"Not authenticated"</span>,
                headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
            )
        <span class="hljs-keyword">return</span> user
</code></pre>
<div class="content-ad"></div>
<ul>
<li>이곳은 인증 애플리케이션의 핵심입니다. 여기서 verify_password, authenticate_user, blocklist_token 등과 같은 모든 중요한 기능을 정의해야 합니다.</li>
</ul>
<h2>단계 5: 사용자 등록 및 토큰 생성</h2>
<h2>controller.py</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> schemas <span class="hljs-keyword">import</span> <span class="hljs-title class_">UserCreate</span>, <span class="hljs-title class_">UserResponse</span>, <span class="hljs-title class_">Token</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">APIRouter</span>
<span class="hljs-keyword">from</span> auth <span class="hljs-keyword">import</span> <span class="hljs-title class_">AuthHandler</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">APIRouter</span>, <span class="hljs-title class_">Depends</span>, <span class="hljs-title class_">HTTPException</span>, status
<span class="hljs-keyword">from</span> fastapi.<span class="hljs-property">security</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">OAuth2PasswordRequestForm</span>
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> timedelta
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> <span class="hljs-title class_">User</span>, fake_users_db
<span class="hljs-keyword">from</span> constants <span class="hljs-keyword">import</span> <span class="hljs-variable constant_">ACCESS_TOKEN_EXPIRE_MINUTES</span>
<span class="hljs-keyword">from</span> fastapi.<span class="hljs-property">security</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">HTTPAuthorizationCredentials</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">Security</span>


auth_router = <span class="hljs-title class_">APIRouter</span>()
auth_handle = <span class="hljs-title class_">AuthHandler</span>()

@auth_router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/register"</span>, response_model=<span class="hljs-title class_">UserResponse</span>)
<span class="hljs-keyword">async</span> def <span class="hljs-title function_">register_user</span>(<span class="hljs-attr">user</span>: <span class="hljs-title class_">UserCreate</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">get_user</span>(user.<span class="hljs-property">username</span>):
        raise <span class="hljs-title class_">HTTPException</span>(
            status_code=status.<span class="hljs-property">HTTP_400_BAD_REQUEST</span>,
            detail=<span class="hljs-string">"이미 등록된 사용자명입니다."</span>,
        )
    hashed_password = <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">get_password_hash</span>(user.<span class="hljs-property">password</span>)
    new_user = <span class="hljs-title class_">User</span>(username=user.<span class="hljs-property">username</span>, email=user.<span class="hljs-property">email</span>, hashed_password=hashed_password)
    fake_users_db.<span class="hljs-title function_">append</span>(new_user)
    <span class="hljs-keyword">return</span> new_user

@auth_router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/token"</span>, response_model=<span class="hljs-title class_">Token</span>)
<span class="hljs-keyword">async</span> def <span class="hljs-title function_">login_for_access_token</span>(<span class="hljs-attr">form_data</span>: <span class="hljs-title class_">OAuth2PasswordRequestForm</span> = <span class="hljs-title class_">Depends</span>()):
    user = <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">authenticate_user</span>(form_data.<span class="hljs-property">username</span>, form_data.<span class="hljs-property">password</span>)
    <span class="hljs-keyword">if</span> not <span class="hljs-attr">user</span>:
        raise <span class="hljs-title class_">HTTPException</span>(
            status_code=status.<span class="hljs-property">HTTP_401_UNAUTHORIZED</span>,
            detail=<span class="hljs-string">"잘못된 사용자명 또는 비밀번호입니다."</span>,
            headers={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
        )
    access_token_expires = <span class="hljs-title function_">timedelta</span>(minutes=<span class="hljs-variable constant_">ACCESS_TOKEN_EXPIRE_MINUTES</span>)
    access_token = <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">create_access_token</span>(
        data={<span class="hljs-string">"sub"</span>: user.<span class="hljs-property">username</span>}, expires_delta=access_token_expires
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"access_token"</span>: access_token, <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"bearer"</span>}

@auth_router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/logout"</span>)
<span class="hljs-keyword">async</span> def <span class="hljs-title function_">logout_access_token</span>(<span class="hljs-attr">auth</span>: <span class="hljs-title class_">HTTPAuthorizationCredentials</span> = <span class="hljs-title class_">Security</span>(auth_handle.<span class="hljs-property">security</span>)):
    <span class="hljs-keyword">await</span> auth_handle.<span class="hljs-title function_">blocklist_token</span>(auth.<span class="hljs-property">credentials</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"로그아웃 되었습니다."</span>}
</code></pre>
<div class="content-ad"></div>
<p>여기에서는 사용자를 등록하고 로그인하며 토큰을 생성하는 데 사용되는 모든 컨트롤러를 정의합니다.</p>
<h2>단계 6: FastAPI와 통합하기</h2>
<p>마지막으로, 모든 것을 주 애플리케이션에 통합하세요.</p>
<h2>main.py</h2>
<div class="content-ad"></div>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends
<span class="hljs-keyword">from</span> controller <span class="hljs-keyword">import</span> auth_router
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> auth <span class="hljs-keyword">import</span> AuthHandler

app = FastAPI()
auth_handler = AuthHandler()
app.include_router(auth_router, prefix=<span class="hljs-string">"/auth"</span>, tags=[<span class="hljs-string">"Auth"</span>])

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/auth-test"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_users_me</span>(<span class="hljs-params">current_user: User = Depends(<span class="hljs-params">auth_handler.auth_wrapper</span>)</span>):
    <span class="hljs-keyword">return</span> current_user
</code></pre>
<p>JWT 인증을 테스트하기 위한 라우트를 만들었습니다.</p>
<p>여기 GitHub 링크 있어요!!</p>
<h2>결론</h2>
<div class="content-ad"></div>
<p>FastAPI 애플리케이션에 JWT 인증을 설정했군요. 이 설정에는 사용자 등록, JWT 토큰 생성을 위한 로그인 및 보호된 경로를 위한 토큰 확인이 포함되어 있어요. JWT는 인증된 사용자만 특정 엔드포인트에 접근할 수 있도록 보장하여 API를 안전하고 사용자 친화적으로 만들어줍니다.</p>
<h2>참고:</h2>
<ul>
<li><a href="https://fastapi.tiangolo.com/" rel="nofollow" target="_blank">https://fastapi.tiangolo.com/</a></li>
</ul>
<p>독서해 주셔서 감사합니다. 만약 잘못된 부분이나 더 좋은 방법을 알고 계시다면 아래 댓글에 알려주세요.</p>
<div class="content-ad"></div>
<p>만약 이 게시물이 마음에 든다면 아래의 👏 버튼을 눌러주세요. 다른 사람들이 유용하게 활용할 수 있도록 도와주세요. 또한 GitHub에서 저를 팔로우하고 Linkedin에서 저와 연결할 수 있습니다.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"빠른 FastAPI 애플리케이션에서 JWT 인증 구현하기","description":"","date":"2024-06-20 14:08","slug":"2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication","content":"\n\n이 블로그 포스트에서는 FastAPI 애플리케이션에서 JWT (JSON Web Token) 인증을 구현하는 방법을 안내하겠습니다. JWT는 두 당사자 간에 주장을 나타내는 컴팩트하고 URL-안전한 수단으로, 보안 인증에 일반적으로 사용됩니다.\n\n![이미지](/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png)\n\n## JWT란 무엇인가요?\n\nJWT는 JSON Web Token의 약자입니다. 일부 주장을 나타내는 토큰을 생성하기 위한 표준입니다. 이러한 토큰들은 비밀 키 또는 공개/개인 키 쌍으로 서명됩니다. 다음은 JWT가 작동하는 간단한 설명입니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 헤더: 일반적으로 토큰 유형 (JWT)과 서명 알고리즘 (예: HMAC SHA256 또는 RSA)으로 구성됩니다.\n\n```json\n{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n```\n\n- 페이로드: 클레임은 개체(일반적으로 사용자)에 관한 문장과 추가 데이터입니다.\n\n```json\n{\n  \"username\": \"rajan\",\n  \"email\": \"rajan12@rajan.com\"\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 서명: 서명 부분을 만들려면 인코딩된 헤더, 인코딩된 페이로드, 비밀키 및 헤더에서 지정한 알고리즘을 가져 와야 합니다.\n\n```js\n# secret id\nABjhjdsjfsh234fjhuih324$jihdfdshkgsog\n```\n\n## JWT의 장점:\n\n- 간결함: JWT는 간결하며 URL, POST 매개변수 또는 HTTP 헤더 안에 전송할 수 있어 모바일 애플리케이션에 적합합니다.\n- 자체 포함: 페이로드에는 인증에 필요한 모든 정보가 포함되어 있어 여러 개의 데이터베이스 쿼리가 필요하지 않습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## FastAPI에서의 단계별 구현\n\n## 단계 1: 의존성 설정\n\n먼저, FastAPI와 관련 의존성이 설치되어 있는지 확인하세요:\n\n```js\npip install fastapi \npip install passlib \npip install python-jose\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 단계 2: 모델 및 스키마 정의\n\n사용자 모델과 요청/응답 스키마를 정의할 것입니다.\n\n## models.py\n\n```python\n# models.py\n\nfrom pydantic import BaseModel\nfrom typing import List\n\nclass User(BaseModel):\n    username: str\n    email: str\n    hashed_password: str\n\n# 메모리 내 \"데이터베이스\"\nfake_users_db: List[User] = []\nblocklist_token = []\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 블로그에서는 데이터를 메모리에 저장합니다. 위의 코드 스니펫에서 볼 수 있듯이, fake_user_db를 사용하여 사용자 세부 정보를 저장하고, blocklist_token을 사용하여 차단된 토큰을 저장합니다.\n\n## schemas.py\n\n```js\nfrom pydantic import BaseModel, EmailStr\n\nclass UserCreate(BaseModel):\n    username: str\n    email: EmailStr\n    password: str\n\nclass UserResponse(BaseModel):\n    username: str\n    email: str\n\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n```\n\n이 스키마 모델은 사용자 요청 본문을 유효성 검사하는 데 사용되며, 적절한 형식으로 응답을 전송합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 단계 3: 설정 상수\n\n## constants.py\n\n```js\nSECRET_KEY = \"your_secret_key\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n```\n\n- 이 파일은 주로 애플리케이션에 상수를 정의하는 데 사용됩니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 단계 4: 인증 핸들러\n\n이것은 우리의 JWT 인증의 핵심입니다. 이는 비밀번호 해싱, 토큰 생성 및 사용자 인증을 처리합니다.\n\n## auth.py\n\n```python\nfrom fastapi import HTTPException, status\nfrom jose import jwt, JWTError\nfrom passlib.context import CryptContext\nfrom datetime import datetime, timedelta\nfrom typing import Optional\nfrom models import fake_users_db, blocklist_token\nfrom constants import SECRET_KEY, ALGORITHM\nfrom fastapi.security import HTTPAuthorizationCredentials, HTTPBearer\nfrom fastapi import Security\n\nclass AuthHandler:\n    security = HTTPBearer()\n    pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n\n    async def verify_password(self, plain_password, hashed_password):\n        return self.pwd_context.verify(plain_password, hashed_password)\n\n    async def get_password_hash(self, password):\n        return self.pwd_context.hash(password)\n\n    async def create_access_token(self, data: dict, expires_delta: Optional[timedelta] = None):\n        to_encode = data.copy()\n        if expires_delta:\n            expire = datetime.utcnow() + expires_delta\n        else:\n            expire = datetime.utcnow() + timedelta(minutes=15)\n        to_encode.update({\"exp\": expire})\n        encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n        return encoded_jwt\n\n    async def get_user(self, username: str):\n        user = next((user for user in fake_users_db if user.username == username), None)\n        return user\n\n    async def authenticate_user(self, username: str, password: str):\n        user = await self.get_user(username)\n        if not user:\n            return False\n        if not await self.verify_password(password, user.hashed_password):\n            return False\n        return user\n    \n    async def blocklist_token(self, token):\n        blocklist_token.append(token)\n\n    async def istokenblock(self, token):\n        return token in blocklist_token\n\n    async def auth_wrapper(self, auth: HTTPAuthorizationCredentials = Security(security)):\n        token = auth.credentials\n        if not token or await self.istokenblock(token):\n            raise HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\"Not authenticated\",\n                headers={\"WWW-Authenticate\": \"Bearer\"},\n            )\n        try:\n            payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n            username: str = payload.get(\"sub\")\n            if username is None:\n                raise HTTPException(\n                    status_code=status.HTTP_401_UNAUTHORIZED,\n                    detail=\"Not authenticated\",\n                    headers={\"WWW-Authenticate\": \"Bearer\"},\n                )\n        except JWTError:\n            raise HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\"Not authenticated\",\n                headers={\"WWW-Authenticate\": \"Bearer\"},\n            )\n        user = await self.get_user(username)\n        if user is None:\n            raise HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\"Not authenticated\",\n                headers={\"WWW-Authenticate\": \"Bearer\"},\n            )\n        return user\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 이곳은 인증 애플리케이션의 핵심입니다. 여기서 verify_password, authenticate_user, blocklist_token 등과 같은 모든 중요한 기능을 정의해야 합니다.\n\n## 단계 5: 사용자 등록 및 토큰 생성\n\n## controller.py\n\n```js\nfrom schemas import UserCreate, UserResponse, Token\nfrom fastapi import APIRouter\nfrom auth import AuthHandler\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom fastapi.security import OAuth2PasswordRequestForm\nfrom datetime import timedelta\nfrom models import User, fake_users_db\nfrom constants import ACCESS_TOKEN_EXPIRE_MINUTES\nfrom fastapi.security import HTTPAuthorizationCredentials\nfrom fastapi import Security\n\n\nauth_router = APIRouter()\nauth_handle = AuthHandler()\n\n@auth_router.post(\"/register\", response_model=UserResponse)\nasync def register_user(user: UserCreate):\n    if await auth_handle.get_user(user.username):\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"이미 등록된 사용자명입니다.\",\n        )\n    hashed_password = await auth_handle.get_password_hash(user.password)\n    new_user = User(username=user.username, email=user.email, hashed_password=hashed_password)\n    fake_users_db.append(new_user)\n    return new_user\n\n@auth_router.post(\"/token\", response_model=Token)\nasync def login_for_access_token(form_data: OAuth2PasswordRequestForm = Depends()):\n    user = await auth_handle.authenticate_user(form_data.username, form_data.password)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"잘못된 사용자명 또는 비밀번호입니다.\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\n    access_token = await auth_handle.create_access_token(\n        data={\"sub\": user.username}, expires_delta=access_token_expires\n    )\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n\n@auth_router.post(\"/logout\")\nasync def logout_access_token(auth: HTTPAuthorizationCredentials = Security(auth_handle.security)):\n    await auth_handle.blocklist_token(auth.credentials)\n    return {\"message\": \"로그아웃 되었습니다.\"}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n여기에서는 사용자를 등록하고 로그인하며 토큰을 생성하는 데 사용되는 모든 컨트롤러를 정의합니다.\n\n## 단계 6: FastAPI와 통합하기\n\n마지막으로, 모든 것을 주 애플리케이션에 통합하세요.\n\n## main.py\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```python\nfrom fastapi import FastAPI, Depends\nfrom controller import auth_router\nfrom models import User\nfrom auth import AuthHandler\n\napp = FastAPI()\nauth_handler = AuthHandler()\napp.include_router(auth_router, prefix=\"/auth\", tags=[\"Auth\"])\n\n@app.get(\"/auth-test\")\nasync def read_users_me(current_user: User = Depends(auth_handler.auth_wrapper)):\n    return current_user\n```\n\nJWT 인증을 테스트하기 위한 라우트를 만들었습니다.\n\n여기 GitHub 링크 있어요!!\n\n## 결론\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nFastAPI 애플리케이션에 JWT 인증을 설정했군요. 이 설정에는 사용자 등록, JWT 토큰 생성을 위한 로그인 및 보호된 경로를 위한 토큰 확인이 포함되어 있어요. JWT는 인증된 사용자만 특정 엔드포인트에 접근할 수 있도록 보장하여 API를 안전하고 사용자 친화적으로 만들어줍니다.\n\n## 참고:\n\n- https://fastapi.tiangolo.com/\n\n독서해 주셔서 감사합니다. 만약 잘못된 부분이나 더 좋은 방법을 알고 계시다면 아래 댓글에 알려주세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n만약 이 게시물이 마음에 든다면 아래의 👏 버튼을 눌러주세요. 다른 사람들이 유용하게 활용할 수 있도록 도와주세요. 또한 GitHub에서 저를 팔로우하고 Linkedin에서 저와 연결할 수 있습니다.","ogImage":{"url":"/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png"},"coverImage":"/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png","tag":["Tech"],"readingTime":9},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e이 블로그 포스트에서는 FastAPI 애플리케이션에서 JWT (JSON Web Token) 인증을 구현하는 방법을 안내하겠습니다. JWT는 두 당사자 간에 주장을 나타내는 컴팩트하고 URL-안전한 수단으로, 보안 인증에 일반적으로 사용됩니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch2\u003eJWT란 무엇인가요?\u003c/h2\u003e\n\u003cp\u003eJWT는 JSON Web Token의 약자입니다. 일부 주장을 나타내는 토큰을 생성하기 위한 표준입니다. 이러한 토큰들은 비밀 키 또는 공개/개인 키 쌍으로 서명됩니다. 다음은 JWT가 작동하는 간단한 설명입니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e헤더: 일반적으로 토큰 유형 (JWT)과 서명 알고리즘 (예: HMAC SHA256 또는 RSA)으로 구성됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"alg\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"HS256\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"typ\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"JWT\"\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e페이로드: 클레임은 개체(일반적으로 사용자)에 관한 문장과 추가 데이터입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"username\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"rajan\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"email\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"rajan12@rajan.com\"\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e서명: 서명 부분을 만들려면 인코딩된 헤더, 인코딩된 페이로드, 비밀키 및 헤더에서 지정한 알고리즘을 가져 와야 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# secret id\n\u003cspan class=\"hljs-title class_\"\u003eABjhjdsjfsh234\u003c/span\u003efjhuih324$jihdfdshkgsog\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eJWT의 장점:\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e간결함: JWT는 간결하며 URL, POST 매개변수 또는 HTTP 헤더 안에 전송할 수 있어 모바일 애플리케이션에 적합합니다.\u003c/li\u003e\n\u003cli\u003e자체 포함: 페이로드에는 인증에 필요한 모든 정보가 포함되어 있어 여러 개의 데이터베이스 쿼리가 필요하지 않습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003eFastAPI에서의 단계별 구현\u003c/h2\u003e\n\u003ch2\u003e단계 1: 의존성 설정\u003c/h2\u003e\n\u003cp\u003e먼저, FastAPI와 관련 의존성이 설치되어 있는지 확인하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epip install fastapi \npip install passlib \npip install python-jose\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e단계 2: 모델 및 스키마 정의\u003c/h2\u003e\n\u003cp\u003e사용자 모델과 요청/응답 스키마를 정의할 것입니다.\u003c/p\u003e\n\u003ch2\u003emodels.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# models.py\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pydantic \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e BaseModel\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e typing \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eList\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e(\u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseModel\u003c/span\u003e):\n    username: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\n    email: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\n    hashed_password: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 메모리 내 \"데이터베이스\"\u003c/span\u003e\nfake_users_db: \u003cspan class=\"hljs-type\"\u003eList\u003c/span\u003e[User] = []\nblocklist_token = []\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e이 블로그에서는 데이터를 메모리에 저장합니다. 위의 코드 스니펫에서 볼 수 있듯이, fake_user_db를 사용하여 사용자 세부 정보를 저장하고, blocklist_token을 사용하여 차단된 토큰을 저장합니다.\u003c/p\u003e\n\u003ch2\u003eschemas.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pydantic \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eEmailStr\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserCreate\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003eusername\u003c/span\u003e: str\n    \u003cspan class=\"hljs-attr\"\u003eemail\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eEmailStr\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003epassword\u003c/span\u003e: str\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserResponse\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003eusername\u003c/span\u003e: str\n    \u003cspan class=\"hljs-attr\"\u003eemail\u003c/span\u003e: str\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eToken\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003eaccess_token\u003c/span\u003e: str\n    \u003cspan class=\"hljs-attr\"\u003etoken_type\u003c/span\u003e: str\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 스키마 모델은 사용자 요청 본문을 유효성 검사하는 데 사용되며, 적절한 형식으로 응답을 전송합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e단계 3: 설정 상수\u003c/h2\u003e\n\u003ch2\u003econstants.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eSECRET_KEY\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"your_secret_key\"\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eALGORITHM\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"HS256\"\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eACCESS_TOKEN_EXPIRE_MINUTES\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e이 파일은 주로 애플리케이션에 상수를 정의하는 데 사용됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e단계 4: 인증 핸들러\u003c/h2\u003e\n\u003cp\u003e이것은 우리의 JWT 인증의 핵심입니다. 이는 비밀번호 해싱, 토큰 생성 및 사용자 인증을 처리합니다.\u003c/p\u003e\n\u003ch2\u003eauth.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e HTTPException, status\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e jose \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e jwt, JWTError\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e passlib.context \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e CryptContext\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e datetime \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e datetime, timedelta\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e typing \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eOptional\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e models \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fake_users_db, blocklist_token\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e constants \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e SECRET_KEY, ALGORITHM\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi.security \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e HTTPAuthorizationCredentials, HTTPBearer\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Security\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAuthHandler\u003c/span\u003e:\n    security = HTTPBearer()\n    pwd_context = CryptContext(schemes=[\u003cspan class=\"hljs-string\"\u003e\"bcrypt\"\u003c/span\u003e], deprecated=\u003cspan class=\"hljs-string\"\u003e\"auto\"\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003everify_password\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, plain_password, hashed_password\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.pwd_context.verify(plain_password, hashed_password)\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_password_hash\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, password\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.pwd_context.\u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e(password)\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreate_access_token\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, data: \u003cspan class=\"hljs-built_in\"\u003edict\u003c/span\u003e, expires_delta: \u003cspan class=\"hljs-type\"\u003eOptional\u003c/span\u003e[timedelta] = \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e\u003c/span\u003e):\n        to_encode = data.copy()\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e expires_delta:\n            expire = datetime.utcnow() + expires_delta\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n            expire = datetime.utcnow() + timedelta(minutes=\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e)\n        to_encode.update({\u003cspan class=\"hljs-string\"\u003e\"exp\"\u003c/span\u003e: expire})\n        encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e encoded_jwt\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_user\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, username: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\u003c/span\u003e):\n        user = \u003cspan class=\"hljs-built_in\"\u003enext\u003c/span\u003e((user \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e fake_users_db \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e user.username == username), \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e user\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eauthenticate_user\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, username: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e, password: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\u003c/span\u003e):\n        user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e self.get_user(username)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e user:\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eFalse\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e self.verify_password(password, user.hashed_password):\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eFalse\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e user\n    \n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eblocklist_token\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, token\u003c/span\u003e):\n        blocklist_token.append(token)\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eistokenblock\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, token\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e token \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e blocklist_token\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eauth_wrapper\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, auth: HTTPAuthorizationCredentials = Security(\u003cspan class=\"hljs-params\"\u003esecurity\u003c/span\u003e)\u003c/span\u003e):\n        token = auth.credentials\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e token \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e self.istokenblock(token):\n            \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\u003cspan class=\"hljs-string\"\u003e\"Not authenticated\"\u003c/span\u003e,\n                headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n            )\n        \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e:\n            payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n            username: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e = payload.get(\u003cspan class=\"hljs-string\"\u003e\"sub\"\u003c/span\u003e)\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e username \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n                \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(\n                    status_code=status.HTTP_401_UNAUTHORIZED,\n                    detail=\u003cspan class=\"hljs-string\"\u003e\"Not authenticated\"\u003c/span\u003e,\n                    headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n                )\n        \u003cspan class=\"hljs-keyword\"\u003eexcept\u003c/span\u003e JWTError:\n            \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\u003cspan class=\"hljs-string\"\u003e\"Not authenticated\"\u003c/span\u003e,\n                headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n            )\n        user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e self.get_user(username)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e user \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\u003cspan class=\"hljs-string\"\u003e\"Not authenticated\"\u003c/span\u003e,\n                headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n            )\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e user\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e이곳은 인증 애플리케이션의 핵심입니다. 여기서 verify_password, authenticate_user, blocklist_token 등과 같은 모든 중요한 기능을 정의해야 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e단계 5: 사용자 등록 및 토큰 생성\u003c/h2\u003e\n\u003ch2\u003econtroller.py\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e schemas \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserCreate\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eUserResponse\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eToken\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAPIRouter\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e auth \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAuthHandler\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAPIRouter\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eDepends\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e, status\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi.\u003cspan class=\"hljs-property\"\u003esecurity\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eOAuth2PasswordRequestForm\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e datetime \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e timedelta\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e models \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e, fake_users_db\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e constants \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eACCESS_TOKEN_EXPIRE_MINUTES\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi.\u003cspan class=\"hljs-property\"\u003esecurity\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHTTPAuthorizationCredentials\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSecurity\u003c/span\u003e\n\n\nauth_router = \u003cspan class=\"hljs-title class_\"\u003eAPIRouter\u003c/span\u003e()\nauth_handle = \u003cspan class=\"hljs-title class_\"\u003eAuthHandler\u003c/span\u003e()\n\n@auth_router.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/register\"\u003c/span\u003e, response_model=\u003cspan class=\"hljs-title class_\"\u003eUserResponse\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"hljs-title function_\"\u003eregister_user\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eUserCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003eget_user\u003c/span\u003e(user.\u003cspan class=\"hljs-property\"\u003eusername\u003c/span\u003e):\n        raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(\n            status_code=status.\u003cspan class=\"hljs-property\"\u003eHTTP_400_BAD_REQUEST\u003c/span\u003e,\n            detail=\u003cspan class=\"hljs-string\"\u003e\"이미 등록된 사용자명입니다.\"\u003c/span\u003e,\n        )\n    hashed_password = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003eget_password_hash\u003c/span\u003e(user.\u003cspan class=\"hljs-property\"\u003epassword\u003c/span\u003e)\n    new_user = \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e(username=user.\u003cspan class=\"hljs-property\"\u003eusername\u003c/span\u003e, email=user.\u003cspan class=\"hljs-property\"\u003eemail\u003c/span\u003e, hashed_password=hashed_password)\n    fake_users_db.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(new_user)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e new_user\n\n@auth_router.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/token\"\u003c/span\u003e, response_model=\u003cspan class=\"hljs-title class_\"\u003eToken\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"hljs-title function_\"\u003elogin_for_access_token\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003eform_data\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eOAuth2PasswordRequestForm\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eDepends\u003c/span\u003e()):\n    user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003eauthenticate_user\u003c/span\u003e(form_data.\u003cspan class=\"hljs-property\"\u003eusername\u003c/span\u003e, form_data.\u003cspan class=\"hljs-property\"\u003epassword\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e not \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e:\n        raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(\n            status_code=status.\u003cspan class=\"hljs-property\"\u003eHTTP_401_UNAUTHORIZED\u003c/span\u003e,\n            detail=\u003cspan class=\"hljs-string\"\u003e\"잘못된 사용자명 또는 비밀번호입니다.\"\u003c/span\u003e,\n            headers={\u003cspan class=\"hljs-string\"\u003e\"WWW-Authenticate\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Bearer\"\u003c/span\u003e},\n        )\n    access_token_expires = \u003cspan class=\"hljs-title function_\"\u003etimedelta\u003c/span\u003e(minutes=\u003cspan class=\"hljs-variable constant_\"\u003eACCESS_TOKEN_EXPIRE_MINUTES\u003c/span\u003e)\n    access_token = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003ecreate_access_token\u003c/span\u003e(\n        data={\u003cspan class=\"hljs-string\"\u003e\"sub\"\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003eusername\u003c/span\u003e}, expires_delta=access_token_expires\n    )\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-string\"\u003e\"access_token\"\u003c/span\u003e: access_token, \u003cspan class=\"hljs-string\"\u003e\"token_type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"bearer\"\u003c/span\u003e}\n\n@auth_router.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/logout\"\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"hljs-title function_\"\u003elogout_access_token\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003eauth\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eHTTPAuthorizationCredentials\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eSecurity\u003c/span\u003e(auth_handle.\u003cspan class=\"hljs-property\"\u003esecurity\u003c/span\u003e)):\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e auth_handle.\u003cspan class=\"hljs-title function_\"\u003eblocklist_token\u003c/span\u003e(auth.\u003cspan class=\"hljs-property\"\u003ecredentials\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"로그아웃 되었습니다.\"\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e여기에서는 사용자를 등록하고 로그인하며 토큰을 생성하는 데 사용되는 모든 컨트롤러를 정의합니다.\u003c/p\u003e\n\u003ch2\u003e단계 6: FastAPI와 통합하기\u003c/h2\u003e\n\u003cp\u003e마지막으로, 모든 것을 주 애플리케이션에 통합하세요.\u003c/p\u003e\n\u003ch2\u003emain.py\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e FastAPI, Depends\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e controller \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e auth_router\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e models \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e User\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e auth \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e AuthHandler\n\napp = FastAPI()\nauth_handler = AuthHandler()\napp.include_router(auth_router, prefix=\u003cspan class=\"hljs-string\"\u003e\"/auth\"\u003c/span\u003e, tags=[\u003cspan class=\"hljs-string\"\u003e\"Auth\"\u003c/span\u003e])\n\n\u003cspan class=\"hljs-meta\"\u003e@app.get(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/auth-test\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eread_users_me\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecurrent_user: User = Depends(\u003cspan class=\"hljs-params\"\u003eauth_handler.auth_wrapper\u003c/span\u003e)\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e current_user\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eJWT 인증을 테스트하기 위한 라우트를 만들었습니다.\u003c/p\u003e\n\u003cp\u003e여기 GitHub 링크 있어요!!\u003c/p\u003e\n\u003ch2\u003e결론\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eFastAPI 애플리케이션에 JWT 인증을 설정했군요. 이 설정에는 사용자 등록, JWT 토큰 생성을 위한 로그인 및 보호된 경로를 위한 토큰 확인이 포함되어 있어요. JWT는 인증된 사용자만 특정 엔드포인트에 접근할 수 있도록 보장하여 API를 안전하고 사용자 친화적으로 만들어줍니다.\u003c/p\u003e\n\u003ch2\u003e참고:\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://fastapi.tiangolo.com/\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://fastapi.tiangolo.com/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e독서해 주셔서 감사합니다. 만약 잘못된 부분이나 더 좋은 방법을 알고 계시다면 아래 댓글에 알려주세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e만약 이 게시물이 마음에 든다면 아래의 👏 버튼을 눌러주세요. 다른 사람들이 유용하게 활용할 수 있도록 도와주세요. 또한 GitHub에서 저를 팔로우하고 Linkedin에서 저와 연결할 수 있습니다.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-20-ImplementingJWTAuthenticationInaFastAPIApplication"},"buildId":"9ddMoNNI_mr3kv4sKx3b_","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>