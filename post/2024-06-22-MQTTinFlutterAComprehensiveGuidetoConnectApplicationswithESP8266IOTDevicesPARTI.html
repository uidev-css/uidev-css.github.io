<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Flutter에서 MQTT로 ESP8266 IOT 기기 연결하는 방법 종합 가이드  PART I | uidev-css</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://uidev-css.github.io///post/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Flutter에서 MQTT로 ESP8266 IOT 기기 연결하는 방법 종합 가이드  PART I | uidev-css" data-gatsby-head="true"/><meta property="og:title" content="Flutter에서 MQTT로 ESP8266 IOT 기기 연결하는 방법 종합 가이드  PART I | uidev-css" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://uidev-css.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://uidev-css.github.io///post/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI" data-gatsby-head="true"/><meta name="twitter:title" content="Flutter에서 MQTT로 ESP8266 IOT 기기 연결하는 방법 종합 가이드  PART I | uidev-css" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | uidev-css" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-22 05:09" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b4eed7811784bdd3.js" defer=""></script><script src="/_next/static/9ddMoNNI_mr3kv4sKx3b_/_buildManifest.js" defer=""></script><script src="/_next/static/9ddMoNNI_mr3kv4sKx3b_/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UIDEV CSS</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Flutter에서 MQTT로 ESP8266 IOT 기기 연결하는 방법 종합 가이드  PART I</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Flutter에서 MQTT로 ESP8266 IOT 기기 연결하는 방법 종합 가이드  PART I" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UIDEV CSS</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 22, 2024</span><span class="posts_reading_time__f7YPP">11<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>요즘에는 많은 IOT 기기들과 작업하고 있어요. 많은 기기들을 다루는 데 큰 어려움이 있어요. 운영, 데이터 수집, 유지관리 등을 모두 집중적으로 하기가 어려워요.</p>
<p><img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_0.png" alt="이미지"></p>
<h2>리얼타임 기기들이 클라우드와 어떻게 소통할 수 있는 가장 좋은 방법은 무엇인가요?</h2>
<p><img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_1.png" alt="이미지"></p>
<div class="content-ad"></div>
<h1>MQTT 프로토콜에 대해 알아봐요!!!!!!!!</h1>
<p>이 글에서는 다음의 내용을 다룹니다.</p>
<ul>
<li>MQTT 브로커와의 ESP8266 연결</li>
<li>MQTT 브로커와의 Flutter 연결</li>
</ul>
<p>가이드를 두 부분으로 나눴어요.</p>
<div class="content-ad"></div>
<p>첫 번째 파트에서는 우리의 브로커와 Esp8266을 구성하는 방법에 대해 다룹니다.</p>
<p>두 번째 파트에서는 어플리케이션에서 데이터를 읽고 쓰는 방법에 대해 다룹니다.</p>
<h2>MQTT 브로커란 무엇인가요?</h2>
<p>아키텍처 사이에서 중개자 역할을 한다고 생각해보세요. Esp8266 장치는 데이터를 브로커로 보내고, 거기서 데이터가 저장됩니다. 그런 후 어플리케이션은 MQTT 브로커에 연결하여 데이터에 접근할 수 있습니다.</p>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_2.png" alt="2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_2.png"></p>
<p><strong>참고:</strong> 대부분의 경우, 데이터를 처리하기 위해 백엔드가 필요하고 응용 프로그램이 이에 액세스하지만, MQTT를 사용하여 연결하고 데이터를 보내는 방법을 알고 나면 쉽다는 것을 이 문서에서 다루지는 않습니다. 나중에 전체 IOT 인프라를 보여주는 글을 쓸 수도 있습니다.</p>
<h1>준비물</h1>
<ul>
<li>MQTT의 이해</li>
<li>발행/구독 아키텍처의 기본 이해</li>
<li>ESP8266 Node MCU 모듈</li>
<li>Flutter 또는 다른 기본 프레임워크에 대한 이해</li>
</ul>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_3.png" alt="image"></p>
<h1>파트 1: 설정</h1>
<p>전체 아키텍처를 구현하려면 먼저 MQTT 브로커가 필요합니다. HiveMQ와 EMQX와 같은 많은 무료 브로커들이 있으며 Mosquitto를 사용하여 로컬 브로커를 만들 수도 있습니다.</p>
<p><img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_4.png" alt="image"></p>
<div class="content-ad"></div>
<p>EMQX에 계정을 등록하고 브로커를 생성했습니다.</p>
<p><img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_5.png" alt="이미지"></p>
<p>그런 다음 브로커에 액세스하는 데 사용될 몇 가지 사용자 계정을 만듭니다.</p>
<p><img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_6.png" alt="이미지"></p>
<div class="content-ad"></div>
<h1>Part 2: ESP8266 펌웨어</h1>
<p>펌웨어 작업을 시작하기 전에 몇 가지 알아야 할 사항이 있습니다.</p>
<p>웹에서 MQTT 브로커에 액세스할 때 TLS를 사용하거나 사용하지 않을 수 있습니다. 제 경험상 TLS를 사용하지 않고 브로커에 연결하려고 시도하면 Esp8266에서 작동하지 않습니다. 모든 연결 요청이 거부됩니다. 따라서 저는 연결을 가장 안전하게 만드는 방법을 보여드리겠습니다.</p>
<ul>
<li>브로커에서 인증서를 다운로드하십시오 (나중에 필요할 것입니다)</li>
</ul>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_7.png" alt="image"></p>
<ul>
<li>Arduino IDE를 열고 Esp8266을 설정합니다.</li>
</ul>
<p>Esp8266을 사용해본 적이 없다면, 이 가이드를 따를 수 있습니다.</p>
<p>우선 라이브러리를 가져오겠습니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">#include &#x3C;<span class="hljs-title class_">ESP8266WiFi</span>.<span class="hljs-property">h</span>>

#include &#x3C;<span class="hljs-title class_">PubSubClient</span>.<span class="hljs-property">h</span>>

<span class="hljs-comment">// 이 부분은 선택 사항입니다. 센서 데이터로 보낼 무작위 숫자를 생성하기 위해 사용했습니다.</span>
#include &#x3C;<span class="hljs-title class_">ESP8266TrueRandom</span>.<span class="hljs-property">h</span>>

<span class="hljs-comment">// 인터넷과의 시간 동기화에 사용됩니다.</span>
#include &#x3C;time.<span class="hljs-property">h</span>>
</code></pre>
<p>이제 자격 증명을 정의해 봅시다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> char *ntp_server = <span class="hljs-string">"0.pool.ntp.org"</span>;     <span class="hljs-comment">// 기본 NTP 서버</span>
<span class="hljs-keyword">const</span> long gmt_offset_sec = <span class="hljs-number">0</span>;            <span class="hljs-comment">// GMT 오프셋(시간대에 맞게 조정)</span>
<span class="hljs-keyword">const</span> int daylight_offset_sec = <span class="hljs-number">0</span>;        <span class="hljs-comment">// 일광 절약 시간 오프셋(초)</span>

<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">SSID</span> = <span class="hljs-string">"************"</span>;
<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">PASSWORD</span> = <span class="hljs-string">"************"</span>;

<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">MQTT_HOST</span> = <span class="hljs-string">"************"</span>; <span class="hljs-comment">// 브로커 대시보드에서 가져오세요</span>
<span class="hljs-keyword">const</span> int <span class="hljs-variable constant_">MQTT_PORT</span> = <span class="hljs-number">8883</span>; <span class="hljs-comment">// 기본 MQTT TCP TLS 포트</span>

<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">MQTT_USERNAME</span> = <span class="hljs-string">""</span>;
<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">MQTT_PASSWORD</span> = <span class="hljs-string">""</span>;
<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">MQTT_TOPIC</span> = <span class="hljs-string">"test"</span>;

char payload[<span class="hljs-number">10</span>] = <span class="hljs-string">""</span>;

<span class="hljs-title class_">BearSSL</span>::<span class="hljs-title class_">WiFiClientSecure</span> espClient;

<span class="hljs-title class_">PubSubClient</span> <span class="hljs-title function_">mqtt_client</span>(espClient);
</code></pre>
<p>이제 다운로드한 인증서 데이터를 입력해 봅시다. 텍스트 편집기로 해당 파일을 열어 내용을 복사하세요.</p>
<div class="content-ad"></div>
<p>다음은 Markdown 형식으로 table 태그를 변경해주세요.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> char ca_cert[] = R<span class="hljs-string">"EOF(
|-----BEGIN CERTIFICATE-----|
|---MIIDrzCCApegAwIBAgIQCDvgVpBCRrGhdWrJWZHHSjANBgkqhkiG9w0BAQUFADBh---|
|---MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3---|
|---d3cuZGlnaWNlcnQuYa9tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD---|
|-----END CERTIFICATE-----|
)EOF"</span>;
</code></pre>
<p>먼저, WiFi에 연결해야 합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">void</span> <span class="hljs-title function_">connectToWiFi</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title class_">WiFi</span>.<span class="hljs-title function_">begin</span>(<span class="hljs-variable constant_">SSID</span>, <span class="hljs-variable constant_">PASSWORD</span>);
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"WiFi에 연결 중"</span>);
    <span class="hljs-keyword">while</span> (<span class="hljs-title class_">WiFi</span>.<span class="hljs-title function_">status</span>() != <span class="hljs-variable constant_">WL_CONNECTED</span>) {
        <span class="hljs-title function_">delay</span>(<span class="hljs-number">500</span>);
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"."</span>);
    }
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"\nWiFi 네트워크에 연결되었습니다"</span>);
}
</code></pre>
<div class="content-ad"></div>
<p>우리의 Esp8266과 시간을 동기화하기 위해 NTP(Network Time Protocol) 서버를 사용합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">void</span> <span class="hljs-title function_">syncTime</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">configTime</span>(gmt_offset_sec, daylight_offset_sec, ntp_server);
    
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"NTP 시간 동기화를 기다리는 중: "</span>);

    <span class="hljs-keyword">while</span> (<span class="hljs-title function_">time</span>(nullptr) &#x3C; <span class="hljs-number">8</span> * <span class="hljs-number">3600</span> * <span class="hljs-number">2</span>) {
        <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"."</span>);
    }

    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"시간이 동기화되었습니다."</span>);
    
    struct tm timeinfo;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getLocalTime</span>(&#x26;timeinfo)) {
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"현재 시간: "</span>);
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-title function_">asctime</span>(&#x26;timeinfo));
    
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"로컬 시간을 가져오지 못했습니다."</span>);
    }
}
</code></pre>
<p>브로커에 연결하려면 다음 함수를 사용할 것입니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">void</span> <span class="hljs-title function_">connectToMQTTBroker</span>(<span class="hljs-params"></span>) {
    
    <span class="hljs-comment">// 우리의 인증서를 사용하여 신뢰할 수 있는 연결 요청을 수행합니다</span>
    <span class="hljs-title class_">BearSSL</span>::X509List <span class="hljs-title function_">serverTrustedCA</span>(ca_cert);

    espClient.<span class="hljs-title function_">setTrustAnchors</span>(&#x26;serverTrustedCA);

    <span class="hljs-keyword">while</span> (!mqtt_client.<span class="hljs-title function_">connected</span>()) {

        <span class="hljs-title class_">String</span> client_id = <span class="hljs-string">"esp8266-client-"</span> + <span class="hljs-title class_">String</span>(<span class="hljs-title class_">WiFi</span>.<span class="hljs-title function_">macAddress</span>());
        
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"%s로 MQTT 브로커에 연결 중.....\n"</span>, client_id.<span class="hljs-title function_">c_str</span>());
        
        <span class="hljs-keyword">if</span> (mqtt_client.<span class="hljs-title function_">connect</span>(client_id.<span class="hljs-title function_">c_str</span>(), <span class="hljs-variable constant_">MQTT_USERNAME</span>, <span class="hljs-variable constant_">MQTT_PASSWORD</span>)) {
            
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"MQTT 브로커에 연결되었습니다."</span>);
        
        } <span class="hljs-keyword">else</span> {
            char err_buf[<span class="hljs-number">128</span>];
            
            espClient.<span class="hljs-title function_">getLastSSLError</span>(err_buf, <span class="hljs-title function_">sizeof</span>(err_buf));
            
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"MQTT 브로커에 연결에 실패했습니다. rc="</span>);
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(mqtt_client.<span class="hljs-title function_">state</span>());
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"SSL 오류: "</span>);
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(err_buf);

            <span class="hljs-title function_">delay</span>(<span class="hljs-number">5000</span>);
        }
    }
}
</code></pre>
<div class="content-ad"></div>
<p>해당 함수를 사용하여 주제에 대한 데이터를 게시합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">void</span> <span class="hljs-title function_">publishData</span>(<span class="hljs-params">int data</span>){
  <span class="hljs-comment">// Int 데이터를 String으로 변환합니다.</span>
  <span class="hljs-title function_">itoa</span>(data, payload, <span class="hljs-number">10</span>);

  <span class="hljs-comment">// 주제 "test"에 데이터를 게시합니다.</span>
  mqtt_client.<span class="hljs-title function_">publish</span>(<span class="hljs-variable constant_">MQTT_TOPIC</span>, payload);
}
</code></pre>
<p>이벤트에 구독하려면 다음과 같이 작성합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribeToTopic</span>(<span class="hljs-params">char* topic</span>){

  mqtt_client.<span class="hljs-title function_">subscribe</span>(topic);
  <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"주제에 구독함: "</span>);
  <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(topic);
}
</code></pre>
<div class="content-ad"></div>
<p>구독한 주제를 듣습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">void</span> <span class="hljs-title function_">mqttCallback</span>(<span class="hljs-params">char *topic, byte *payload, unsigned int length</span>) {
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"주제에서 메시지 받음: "</span>);
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(topic);
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"메시지:"</span>);
    <span class="hljs-keyword">for</span> (unsigned int i = <span class="hljs-number">0</span>; i &#x3C; length; i++) {
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>((char) payload[i]);
    }
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>();
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"-----------------------"</span>);
}
</code></pre>
<p>마지막으로 전체 펌웨어 코드를 작성해 봅시다.</p>
<pre><code class="hljs language-js">#include &#x3C;<span class="hljs-title class_">ESP8266WiFi</span>.<span class="hljs-property">h</span>>
#include &#x3C;<span class="hljs-title class_">PubSubClient</span>.<span class="hljs-property">h</span>>
#include &#x3C;<span class="hljs-title class_">ESP8266TrueRandom</span>.<span class="hljs-property">h</span>>
#include &#x3C;time.<span class="hljs-property">h</span>>

<span class="hljs-comment">// NTP 서버 설정</span>
<span class="hljs-keyword">const</span> char *ntp_server = <span class="hljs-string">"0.pool.ntp.org"</span>;     <span class="hljs-comment">// 기본 NTP 서버</span>
<span class="hljs-keyword">const</span> long gmt_offset_sec = <span class="hljs-number">0</span>;            <span class="hljs-comment">// GMT 오프셋(시간대에 따라 조정)</span>
<span class="hljs-keyword">const</span> int daylight_offset_sec = <span class="hljs-number">0</span>;        <span class="hljs-comment">// 일광 절약 시간 오프셋(초)</span>

<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">SSID</span> = <span class="hljs-string">"본인의 와이파이를 사용해주세요"</span>;
<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">PASSWORD</span> = <span class="hljs-string">"패스워드"</span>;

<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">MQTT_HOST</span> = <span class="hljs-string">"f4b0e072.ala.asia-southeast1.emqxsl.com"</span>;
<span class="hljs-keyword">const</span> int <span class="hljs-variable constant_">MQTT_PORT</span> = <span class="hljs-number">8883</span>;

<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">MQTT_USERNAME</span> = <span class="hljs-string">"test2"</span>;
<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">MQTT_PASSWORD</span> = <span class="hljs-string">"testpass123A"</span>;
<span class="hljs-keyword">const</span> char* <span class="hljs-variable constant_">MQTT_TOPIC</span> = <span class="hljs-string">"test"</span>;

char payload[<span class="hljs-number">10</span>] = <span class="hljs-string">""</span>;

<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> char ca_cert[] = R<span class="hljs-string">"EOF(
-----BEGIN CERTIFICATE-----
여기에 인증서 내용을 복사하세요
-----END CERTIFICATE-----
)EOF"</span>;

<span class="hljs-title class_">BearSSL</span>::<span class="hljs-title class_">WiFiClientSecure</span> espClient;
<span class="hljs-title class_">PubSubClient</span> <span class="hljs-title function_">mqtt_client</span>(espClient);

<span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribeToTopic</span>(<span class="hljs-params">char* topic</span>){

  mqtt_client.<span class="hljs-title function_">subscribe</span>(topic);
  <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"주제에 구독 완료: "</span>);
  <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(topic);
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">mqttCallback</span>(<span class="hljs-params">char *topic, byte *payload, unsigned int length</span>) {
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"주제에서 받은 메시지: "</span>);
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(topic);
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"메시지:"</span>);
    <span class="hljs-keyword">for</span> (unsigned int i = <span class="hljs-number">0</span>; i &#x3C; length; i++) {
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>((char) payload[i]);
    }
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>();
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"-----------------------"</span>);
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">connectToMQTTBroker</span>(<span class="hljs-params"></span>) {
    
    <span class="hljs-comment">// 인증서를 사용하여 신뢰할 수 있는 연결 요청을 수행합니다</span>
    <span class="hljs-title class_">BearSSL</span>::X509List <span class="hljs-title function_">serverTrustedCA</span>(ca_cert);

    espClient.<span class="hljs-title function_">setTrustAnchors</span>(&#x26;serverTrustedCA);

    <span class="hljs-keyword">while</span> (!mqtt_client.<span class="hljs-title function_">connected</span>()) {

        <span class="hljs-title class_">String</span> client_id = <span class="hljs-string">"esp8266-client-"</span> + <span class="hljs-title class_">String</span>(<span class="hljs-title class_">WiFi</span>.<span class="hljs-title function_">macAddress</span>());
        
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"%s로 MQTT 브로커에 연결 중.....\n"</span>, client_id.<span class="hljs-title function_">c_str</span>());
        
        <span class="hljs-keyword">if</span> (mqtt_client.<span class="hljs-title function_">connect</span>(client_id.<span class="hljs-title function_">c_str</span>(), <span class="hljs-variable constant_">MQTT_USERNAME</span>, <span class="hljs-variable constant_">MQTT_PASSWORD</span>)) {
            
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"MQTT 브로커에 연결됨"</span>);

            <span class="hljs-title function_">subscribeToTopic</span>(<span class="hljs-string">"test"</span>);
        
        } <span class="hljs-keyword">else</span> {
            char err_buf[<span class="hljs-number">128</span>];
            
            espClient.<span class="hljs-title function_">getLastSSLError</span>(err_buf, <span class="hljs-title function_">sizeof</span>(err_buf));
            
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"MQTT 브로커에 연결 실패, 상태="</span>);
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(mqtt_client.<span class="hljs-title function_">state</span>());
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"SSL 오류: "</span>);
            <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(err_buf);

            <span class="hljs-title function_">delay</span>(<span class="hljs-number">5000</span>);
        }
    }
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">syncTime</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">configTime</span>(gmt_offset_sec, daylight_offset_sec, ntp_server);
    
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"NTP 시간 동기화 대기 중: "</span>);

    <span class="hljs-keyword">while</span> (<span class="hljs-title function_">time</span>(nullptr) &#x3C; <span class="hljs-number">8</span> * <span class="hljs-number">3600</span> * <span class="hljs-number">2</span>) {
        <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"."</span>);
    }

    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"시간 동기화 완료"</span>);
    
    struct tm timeinfo;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getLocalTime</span>(&#x26;timeinfo)) {
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"현재 시간: "</span>);
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-title function_">asctime</span>(&#x26;timeinfo));
    
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"로컬 시간 획득 실패"</span>);
    }
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">publishData</span>(<span class="hljs-params">int data</span>){
  <span class="hljs-comment">// 정수 데이터를 문자열로 변환합니다</span>
  <span class="hljs-title function_">itoa</span>(data,payload,<span class="hljs-number">10</span>);

  <span class="hljs-comment">// "test" 주제에 데이터를 발행합니다</span>
  mqtt_client.<span class="hljs-title function_">publish</span>(<span class="hljs-variable constant_">MQTT_TOPIC</span>,payload);
}


<span class="hljs-keyword">void</span> <span class="hljs-title function_">connectToWiFi</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title class_">WiFi</span>.<span class="hljs-title function_">begin</span>(<span class="hljs-variable constant_">SSID</span>, <span class="hljs-variable constant_">PASSWORD</span>);
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"WiFi에 연결 중"</span>);
    <span class="hljs-keyword">while</span> (<span class="hljs-title class_">WiFi</span>.<span class="hljs-title function_">status</span>() != <span class="hljs-variable constant_">WL_CONNECTED</span>) {
        <span class="hljs-title function_">delay</span>(<span class="hljs-number">500</span>);
        <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">print</span>(<span class="hljs-string">"."</span>);
    }
    <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"\nWiFi 네트워크에 연결됨"</span>);
}


<span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">begin</span>(<span class="hljs-number">115200</span>);

  <span class="hljs-title function_">connectToWiFi</span>();

  <span class="hljs-title function_">syncTime</span>();

  mqtt_client.<span class="hljs-title function_">setServer</span>(<span class="hljs-variable constant_">MQTT_HOST</span>,<span class="hljs-variable constant_">MQTT_PORT</span>);

  <span class="hljs-title function_">connectToMQTTBroker</span>();

}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">if</span> (!mqtt_client.<span class="hljs-title function_">connected</span>()) {
        <span class="hljs-title function_">connectToMQTTBroker</span>();
    }


    mqtt_client.<span class="hljs-title function_">loop</span>();

    <span class="hljs-comment">// 3초마다 무작위 숫자를 보냅니다. 여러분은 센서 데이터를 전송할 수 있습니다.</span>
    <span class="hljs-title function_">publishData</span>(<span class="hljs-title class_">ESP8266TrueRandom</span>.<span class="hljs-title function_">random</span>(<span class="hljs-number">1</span>,<span class="hljs-number">500</span>));
    <span class="hljs-title function_">delay</span>(<span class="hljs-number">3000</span>);

}
</code></pre>
<div class="content-ad"></div>
<p>마침내, 코드를 Esp8266에 업로드하세요.</p>
<p>mqtt-cli를 설치하고 컴퓨터 터미널에서 실행하여 데이터가 발행되는지 확인하세요.</p>
<p>설치 후, 다음 명령어를 실행하세요</p>
<pre><code class="hljs language-js">mqtt sub -h &#x3C;호스트> -p &#x3C;포트> -s -u &#x3C;사용자이름> -pw &#x3C;비밀번호> -t &#x3C;토픽>
</code></pre>
<div class="content-ad"></div>
<p>우리 경우에는 "test" 주제입니다.</p>
<p>다음 출력을 볼 수 있습니다.</p>
<img src="/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_8.png">
<p>이것은 우리의 Esp8266이 데이터를 MQTT 브로커로 보내고, 우리 컴퓨터에서 실행되는 CLI 도구를 사용하여 해당 데이터를 구독한다는 것을 보여줍니다.</p>
<div class="content-ad"></div>
<h1>마지막으로</h1>
<p>MQTT를 Esp8266 및 Flutter와 함께 사용하는 방법에 대한 두 부분 가이드의 첫 번째 부분이 끝났습니다.</p>
<p>소중한 시간 내주셔서 감사합니다. 이에 대한 생각을 알려주세요!</p>
<p>도움이 되었다면 LinkedIn에서 제 소식을 지켜보실 수도 있습니다.</p>
<div class="content-ad"></div>
<p><img src="https://miro.medium.com/v2/resize:fit:440/0*xIWi3szlPmvPpqh0.gif" alt="Animated GIF"></p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Flutter에서 MQTT로 ESP8266 IOT 기기 연결하는 방법 종합 가이드  PART I","description":"","date":"2024-06-22 05:09","slug":"2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI","content":"\n\n요즘에는 많은 IOT 기기들과 작업하고 있어요. 많은 기기들을 다루는 데 큰 어려움이 있어요. 운영, 데이터 수집, 유지관리 등을 모두 집중적으로 하기가 어려워요.\n\n![이미지](/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_0.png)\n\n## 리얼타임 기기들이 클라우드와 어떻게 소통할 수 있는 가장 좋은 방법은 무엇인가요?\n\n![이미지](/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_1.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# MQTT 프로토콜에 대해 알아봐요!!!!!!!!\n\n이 글에서는 다음의 내용을 다룹니다.\n\n- MQTT 브로커와의 ESP8266 연결\n- MQTT 브로커와의 Flutter 연결\n\n가이드를 두 부분으로 나눴어요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n첫 번째 파트에서는 우리의 브로커와 Esp8266을 구성하는 방법에 대해 다룹니다.\n\n두 번째 파트에서는 어플리케이션에서 데이터를 읽고 쓰는 방법에 대해 다룹니다.\n\n## MQTT 브로커란 무엇인가요?\n\n아키텍처 사이에서 중개자 역할을 한다고 생각해보세요. Esp8266 장치는 데이터를 브로커로 보내고, 거기서 데이터가 저장됩니다. 그런 후 어플리케이션은 MQTT 브로커에 연결하여 데이터에 접근할 수 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n![2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_2.png](/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_2.png)\n\n**참고:** 대부분의 경우, 데이터를 처리하기 위해 백엔드가 필요하고 응용 프로그램이 이에 액세스하지만, MQTT를 사용하여 연결하고 데이터를 보내는 방법을 알고 나면 쉽다는 것을 이 문서에서 다루지는 않습니다. 나중에 전체 IOT 인프라를 보여주는 글을 쓸 수도 있습니다.\n\n# 준비물\n\n- MQTT의 이해\n- 발행/구독 아키텍처의 기본 이해\n- ESP8266 Node MCU 모듈\n- Flutter 또는 다른 기본 프레임워크에 대한 이해\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n![image](/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_3.png)\n\n# 파트 1: 설정\n\n전체 아키텍처를 구현하려면 먼저 MQTT 브로커가 필요합니다. HiveMQ와 EMQX와 같은 많은 무료 브로커들이 있으며 Mosquitto를 사용하여 로컬 브로커를 만들 수도 있습니다.\n\n![image](/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_4.png)\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nEMQX에 계정을 등록하고 브로커를 생성했습니다.\n\n![이미지](/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_5.png)\n\n그런 다음 브로커에 액세스하는 데 사용될 몇 가지 사용자 계정을 만듭니다.\n\n![이미지](/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_6.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# Part 2: ESP8266 펌웨어\n\n펌웨어 작업을 시작하기 전에 몇 가지 알아야 할 사항이 있습니다.\n\n웹에서 MQTT 브로커에 액세스할 때 TLS를 사용하거나 사용하지 않을 수 있습니다. 제 경험상 TLS를 사용하지 않고 브로커에 연결하려고 시도하면 Esp8266에서 작동하지 않습니다. 모든 연결 요청이 거부됩니다. 따라서 저는 연결을 가장 안전하게 만드는 방법을 보여드리겠습니다.\n\n- 브로커에서 인증서를 다운로드하십시오 (나중에 필요할 것입니다)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n![image](/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_7.png)\n\n- Arduino IDE를 열고 Esp8266을 설정합니다.\n\nEsp8266을 사용해본 적이 없다면, 이 가이드를 따를 수 있습니다.\n\n우선 라이브러리를 가져오겠습니다.\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\r\n#include \u003cESP8266WiFi.h\u003e\n\n#include \u003cPubSubClient.h\u003e\n\n// 이 부분은 선택 사항입니다. 센서 데이터로 보낼 무작위 숫자를 생성하기 위해 사용했습니다.\n#include \u003cESP8266TrueRandom.h\u003e\n\n// 인터넷과의 시간 동기화에 사용됩니다.\n#include \u003ctime.h\u003e\r\n```\n\n이제 자격 증명을 정의해 봅시다.\n\n```js\r\nconst char *ntp_server = \"0.pool.ntp.org\";     // 기본 NTP 서버\nconst long gmt_offset_sec = 0;            // GMT 오프셋(시간대에 맞게 조정)\nconst int daylight_offset_sec = 0;        // 일광 절약 시간 오프셋(초)\n\nconst char* SSID = \"************\";\nconst char* PASSWORD = \"************\";\n\nconst char* MQTT_HOST = \"************\"; // 브로커 대시보드에서 가져오세요\nconst int MQTT_PORT = 8883; // 기본 MQTT TCP TLS 포트\n\nconst char* MQTT_USERNAME = \"\";\nconst char* MQTT_PASSWORD = \"\";\nconst char* MQTT_TOPIC = \"test\";\n\nchar payload[10] = \"\";\n\nBearSSL::WiFiClientSecure espClient;\n\nPubSubClient mqtt_client(espClient);\r\n```\n\n이제 다운로드한 인증서 데이터를 입력해 봅시다. 텍스트 편집기로 해당 파일을 열어 내용을 복사하세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n다음은 Markdown 형식으로 table 태그를 변경해주세요.\n\n```js\nstatic const char ca_cert[] = R\"EOF(\n|-----BEGIN CERTIFICATE-----|\n|---MIIDrzCCApegAwIBAgIQCDvgVpBCRrGhdWrJWZHHSjANBgkqhkiG9w0BAQUFADBh---|\n|---MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3---|\n|---d3cuZGlnaWNlcnQuYa9tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD---|\n|-----END CERTIFICATE-----|\n)EOF\";\r\n```\n\n먼저, WiFi에 연결해야 합니다.\n\n```js\r\nvoid connectToWiFi() {\r\n    WiFi.begin(SSID, PASSWORD);\r\n    Serial.print(\"WiFi에 연결 중\");\r\n    while (WiFi.status() != WL_CONNECTED) {\r\n        delay(500);\r\n        Serial.print(\".\");\r\n    }\r\n    Serial.println(\"\\nWiFi 네트워크에 연결되었습니다\");\r\n}\r\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n우리의 Esp8266과 시간을 동기화하기 위해 NTP(Network Time Protocol) 서버를 사용합니다.\n\n```js\nvoid syncTime() {\n    configTime(gmt_offset_sec, daylight_offset_sec, ntp_server);\n    \n    Serial.print(\"NTP 시간 동기화를 기다리는 중: \");\n\n    while (time(nullptr) \u003c 8 * 3600 * 2) {\n        delay(1000);\n        Serial.print(\".\");\n    }\n\n    Serial.println(\"시간이 동기화되었습니다.\");\n    \n    struct tm timeinfo;\n    \n    if (getLocalTime(\u0026timeinfo)) {\n        Serial.print(\"현재 시간: \");\n        Serial.println(asctime(\u0026timeinfo));\n    \n    } else {\n        Serial.println(\"로컬 시간을 가져오지 못했습니다.\");\n    }\n}\n```\n\n브로커에 연결하려면 다음 함수를 사용할 것입니다.\n\n```js\nvoid connectToMQTTBroker() {\n    \n    // 우리의 인증서를 사용하여 신뢰할 수 있는 연결 요청을 수행합니다\n    BearSSL::X509List serverTrustedCA(ca_cert);\n\n    espClient.setTrustAnchors(\u0026serverTrustedCA);\n\n    while (!mqtt_client.connected()) {\n\n        String client_id = \"esp8266-client-\" + String(WiFi.macAddress());\n        \n        Serial.printf(\"%s로 MQTT 브로커에 연결 중.....\\n\", client_id.c_str());\n        \n        if (mqtt_client.connect(client_id.c_str(), MQTT_USERNAME, MQTT_PASSWORD)) {\n            \n            Serial.println(\"MQTT 브로커에 연결되었습니다.\");\n        \n        } else {\n            char err_buf[128];\n            \n            espClient.getLastSSLError(err_buf, sizeof(err_buf));\n            \n            Serial.print(\"MQTT 브로커에 연결에 실패했습니다. rc=\");\n            Serial.println(mqtt_client.state());\n            Serial.print(\"SSL 오류: \");\n            Serial.println(err_buf);\n\n            delay(5000);\n        }\n    }\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n해당 함수를 사용하여 주제에 대한 데이터를 게시합니다.\n\n```js\nvoid publishData(int data){\n  // Int 데이터를 String으로 변환합니다.\n  itoa(data, payload, 10);\n\n  // 주제 \"test\"에 데이터를 게시합니다.\n  mqtt_client.publish(MQTT_TOPIC, payload);\n}\n```\n\n이벤트에 구독하려면 다음과 같이 작성합니다.\n\n```js\nvoid subscribeToTopic(char* topic){\n\n  mqtt_client.subscribe(topic);\n  Serial.print(\"주제에 구독함: \");\n  Serial.println(topic);\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n구독한 주제를 듣습니다.\n\n```js\nvoid mqttCallback(char *topic, byte *payload, unsigned int length) {\n    Serial.print(\"주제에서 메시지 받음: \");\n    Serial.println(topic);\n    Serial.print(\"메시지:\");\n    for (unsigned int i = 0; i \u003c length; i++) {\n        Serial.print((char) payload[i]);\n    }\n    Serial.println();\n    Serial.println(\"-----------------------\");\n}\n```\n\n마지막으로 전체 펌웨어 코드를 작성해 봅시다.\n\n```js\n#include \u003cESP8266WiFi.h\u003e\n#include \u003cPubSubClient.h\u003e\n#include \u003cESP8266TrueRandom.h\u003e\n#include \u003ctime.h\u003e\n\n// NTP 서버 설정\nconst char *ntp_server = \"0.pool.ntp.org\";     // 기본 NTP 서버\nconst long gmt_offset_sec = 0;            // GMT 오프셋(시간대에 따라 조정)\nconst int daylight_offset_sec = 0;        // 일광 절약 시간 오프셋(초)\n\nconst char* SSID = \"본인의 와이파이를 사용해주세요\";\nconst char* PASSWORD = \"패스워드\";\n\nconst char* MQTT_HOST = \"f4b0e072.ala.asia-southeast1.emqxsl.com\";\nconst int MQTT_PORT = 8883;\n\nconst char* MQTT_USERNAME = \"test2\";\nconst char* MQTT_PASSWORD = \"testpass123A\";\nconst char* MQTT_TOPIC = \"test\";\n\nchar payload[10] = \"\";\n\nstatic const char ca_cert[] = R\"EOF(\n-----BEGIN CERTIFICATE-----\n여기에 인증서 내용을 복사하세요\n-----END CERTIFICATE-----\n)EOF\";\n\nBearSSL::WiFiClientSecure espClient;\nPubSubClient mqtt_client(espClient);\n\nvoid subscribeToTopic(char* topic){\n\n  mqtt_client.subscribe(topic);\n  Serial.print(\"주제에 구독 완료: \");\n  Serial.println(topic);\n}\n\nvoid mqttCallback(char *topic, byte *payload, unsigned int length) {\n    Serial.print(\"주제에서 받은 메시지: \");\n    Serial.println(topic);\n    Serial.print(\"메시지:\");\n    for (unsigned int i = 0; i \u003c length; i++) {\n        Serial.print((char) payload[i]);\n    }\n    Serial.println();\n    Serial.println(\"-----------------------\");\n}\n\nvoid connectToMQTTBroker() {\n    \n    // 인증서를 사용하여 신뢰할 수 있는 연결 요청을 수행합니다\n    BearSSL::X509List serverTrustedCA(ca_cert);\n\n    espClient.setTrustAnchors(\u0026serverTrustedCA);\n\n    while (!mqtt_client.connected()) {\n\n        String client_id = \"esp8266-client-\" + String(WiFi.macAddress());\n        \n        Serial.printf(\"%s로 MQTT 브로커에 연결 중.....\\n\", client_id.c_str());\n        \n        if (mqtt_client.connect(client_id.c_str(), MQTT_USERNAME, MQTT_PASSWORD)) {\n            \n            Serial.println(\"MQTT 브로커에 연결됨\");\n\n            subscribeToTopic(\"test\");\n        \n        } else {\n            char err_buf[128];\n            \n            espClient.getLastSSLError(err_buf, sizeof(err_buf));\n            \n            Serial.print(\"MQTT 브로커에 연결 실패, 상태=\");\n            Serial.println(mqtt_client.state());\n            Serial.print(\"SSL 오류: \");\n            Serial.println(err_buf);\n\n            delay(5000);\n        }\n    }\n}\n\nvoid syncTime() {\n    configTime(gmt_offset_sec, daylight_offset_sec, ntp_server);\n    \n    Serial.print(\"NTP 시간 동기화 대기 중: \");\n\n    while (time(nullptr) \u003c 8 * 3600 * 2) {\n        delay(1000);\n        Serial.print(\".\");\n    }\n\n    Serial.println(\"시간 동기화 완료\");\n    \n    struct tm timeinfo;\n    \n    if (getLocalTime(\u0026timeinfo)) {\n        Serial.print(\"현재 시간: \");\n        Serial.println(asctime(\u0026timeinfo));\n    \n    } else {\n        Serial.println(\"로컬 시간 획득 실패\");\n    }\n}\n\nvoid publishData(int data){\n  // 정수 데이터를 문자열로 변환합니다\n  itoa(data,payload,10);\n\n  // \"test\" 주제에 데이터를 발행합니다\n  mqtt_client.publish(MQTT_TOPIC,payload);\n}\n\n\nvoid connectToWiFi() {\n    WiFi.begin(SSID, PASSWORD);\n    Serial.print(\"WiFi에 연결 중\");\n    while (WiFi.status() != WL_CONNECTED) {\n        delay(500);\n        Serial.print(\".\");\n    }\n    Serial.println(\"\\nWiFi 네트워크에 연결됨\");\n}\n\n\nvoid setup() {\n  Serial.begin(115200);\n\n  connectToWiFi();\n\n  syncTime();\n\n  mqtt_client.setServer(MQTT_HOST,MQTT_PORT);\n\n  connectToMQTTBroker();\n\n}\n\nvoid loop() {\n  if (!mqtt_client.connected()) {\n        connectToMQTTBroker();\n    }\n\n\n    mqtt_client.loop();\n\n    // 3초마다 무작위 숫자를 보냅니다. 여러분은 센서 데이터를 전송할 수 있습니다.\n    publishData(ESP8266TrueRandom.random(1,500));\n    delay(3000);\n\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n마침내, 코드를 Esp8266에 업로드하세요.\n\nmqtt-cli를 설치하고 컴퓨터 터미널에서 실행하여 데이터가 발행되는지 확인하세요.\n\n설치 후, 다음 명령어를 실행하세요\n\n```js\nmqtt sub -h \u003c호스트\u003e -p \u003c포트\u003e -s -u \u003c사용자이름\u003e -pw \u003c비밀번호\u003e -t \u003c토픽\u003e\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n우리 경우에는 \"test\" 주제입니다.\n\n다음 출력을 볼 수 있습니다.\n\n\n\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_8.png\" /\u003e\n\n\n이것은 우리의 Esp8266이 데이터를 MQTT 브로커로 보내고, 우리 컴퓨터에서 실행되는 CLI 도구를 사용하여 해당 데이터를 구독한다는 것을 보여줍니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 마지막으로\n\nMQTT를 Esp8266 및 Flutter와 함께 사용하는 방법에 대한 두 부분 가이드의 첫 번째 부분이 끝났습니다.\n\n소중한 시간 내주셔서 감사합니다. 이에 대한 생각을 알려주세요!\n\n도움이 되었다면 LinkedIn에서 제 소식을 지켜보실 수도 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n![Animated GIF](https://miro.medium.com/v2/resize:fit:440/0*xIWi3szlPmvPpqh0.gif)","ogImage":{"url":"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_0.png"},"coverImage":"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_0.png","tag":["Tech"],"readingTime":11},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e요즘에는 많은 IOT 기기들과 작업하고 있어요. 많은 기기들을 다루는 데 큰 어려움이 있어요. 운영, 데이터 수집, 유지관리 등을 모두 집중적으로 하기가 어려워요.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch2\u003e리얼타임 기기들이 클라우드와 어떻게 소통할 수 있는 가장 좋은 방법은 무엇인가요?\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_1.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003eMQTT 프로토콜에 대해 알아봐요!!!!!!!!\u003c/h1\u003e\n\u003cp\u003e이 글에서는 다음의 내용을 다룹니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMQTT 브로커와의 ESP8266 연결\u003c/li\u003e\n\u003cli\u003eMQTT 브로커와의 Flutter 연결\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e가이드를 두 부분으로 나눴어요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e첫 번째 파트에서는 우리의 브로커와 Esp8266을 구성하는 방법에 대해 다룹니다.\u003c/p\u003e\n\u003cp\u003e두 번째 파트에서는 어플리케이션에서 데이터를 읽고 쓰는 방법에 대해 다룹니다.\u003c/p\u003e\n\u003ch2\u003eMQTT 브로커란 무엇인가요?\u003c/h2\u003e\n\u003cp\u003e아키텍처 사이에서 중개자 역할을 한다고 생각해보세요. Esp8266 장치는 데이터를 브로커로 보내고, 거기서 데이터가 저장됩니다. 그런 후 어플리케이션은 MQTT 브로커에 연결하여 데이터에 접근할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_2.png\" alt=\"2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_2.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e참고:\u003c/strong\u003e 대부분의 경우, 데이터를 처리하기 위해 백엔드가 필요하고 응용 프로그램이 이에 액세스하지만, MQTT를 사용하여 연결하고 데이터를 보내는 방법을 알고 나면 쉽다는 것을 이 문서에서 다루지는 않습니다. 나중에 전체 IOT 인프라를 보여주는 글을 쓸 수도 있습니다.\u003c/p\u003e\n\u003ch1\u003e준비물\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eMQTT의 이해\u003c/li\u003e\n\u003cli\u003e발행/구독 아키텍처의 기본 이해\u003c/li\u003e\n\u003cli\u003eESP8266 Node MCU 모듈\u003c/li\u003e\n\u003cli\u003eFlutter 또는 다른 기본 프레임워크에 대한 이해\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_3.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch1\u003e파트 1: 설정\u003c/h1\u003e\n\u003cp\u003e전체 아키텍처를 구현하려면 먼저 MQTT 브로커가 필요합니다. HiveMQ와 EMQX와 같은 많은 무료 브로커들이 있으며 Mosquitto를 사용하여 로컬 브로커를 만들 수도 있습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_4.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eEMQX에 계정을 등록하고 브로커를 생성했습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_5.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e그런 다음 브로커에 액세스하는 데 사용될 몇 가지 사용자 계정을 만듭니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_6.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003ePart 2: ESP8266 펌웨어\u003c/h1\u003e\n\u003cp\u003e펌웨어 작업을 시작하기 전에 몇 가지 알아야 할 사항이 있습니다.\u003c/p\u003e\n\u003cp\u003e웹에서 MQTT 브로커에 액세스할 때 TLS를 사용하거나 사용하지 않을 수 있습니다. 제 경험상 TLS를 사용하지 않고 브로커에 연결하려고 시도하면 Esp8266에서 작동하지 않습니다. 모든 연결 요청이 거부됩니다. 따라서 저는 연결을 가장 안전하게 만드는 방법을 보여드리겠습니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e브로커에서 인증서를 다운로드하십시오 (나중에 필요할 것입니다)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_7.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eArduino IDE를 열고 Esp8266을 설정합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eEsp8266을 사용해본 적이 없다면, 이 가이드를 따를 수 있습니다.\u003c/p\u003e\n\u003cp\u003e우선 라이브러리를 가져오겠습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#include \u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003eESP8266WiFi\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eh\u003c/span\u003e\u003e\n\n#include \u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003ePubSubClient\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eh\u003c/span\u003e\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 이 부분은 선택 사항입니다. 센서 데이터로 보낼 무작위 숫자를 생성하기 위해 사용했습니다.\u003c/span\u003e\n#include \u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003eESP8266TrueRandom\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eh\u003c/span\u003e\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 인터넷과의 시간 동기화에 사용됩니다.\u003c/span\u003e\n#include \u0026#x3C;time.\u003cspan class=\"hljs-property\"\u003eh\u003c/span\u003e\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 자격 증명을 정의해 봅시다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char *ntp_server = \u003cspan class=\"hljs-string\"\u003e\"0.pool.ntp.org\"\u003c/span\u003e;     \u003cspan class=\"hljs-comment\"\u003e// 기본 NTP 서버\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e long gmt_offset_sec = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;            \u003cspan class=\"hljs-comment\"\u003e// GMT 오프셋(시간대에 맞게 조정)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e int daylight_offset_sec = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;        \u003cspan class=\"hljs-comment\"\u003e// 일광 절약 시간 오프셋(초)\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eSSID\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"************\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003ePASSWORD\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"************\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_HOST\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"************\"\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// 브로커 대시보드에서 가져오세요\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e int \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_PORT\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e8883\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// 기본 MQTT TCP TLS 포트\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_USERNAME\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_PASSWORD\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_TOPIC\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e;\n\nchar payload[\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-title class_\"\u003eBearSSL\u003c/span\u003e::\u003cspan class=\"hljs-title class_\"\u003eWiFiClientSecure\u003c/span\u003e espClient;\n\n\u003cspan class=\"hljs-title class_\"\u003ePubSubClient\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emqtt_client\u003c/span\u003e(espClient);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 다운로드한 인증서 데이터를 입력해 봅시다. 텍스트 편집기로 해당 파일을 열어 내용을 복사하세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e다음은 Markdown 형식으로 table 태그를 변경해주세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char ca_cert[] = R\u003cspan class=\"hljs-string\"\u003e\"EOF(\n|-----BEGIN CERTIFICATE-----|\n|---MIIDrzCCApegAwIBAgIQCDvgVpBCRrGhdWrJWZHHSjANBgkqhkiG9w0BAQUFADBh---|\n|---MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3---|\n|---d3cuZGlnaWNlcnQuYa9tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD---|\n|-----END CERTIFICATE-----|\n)EOF\"\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e먼저, WiFi에 연결해야 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003econnectToWiFi\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\r\n    \u003cspan class=\"hljs-title class_\"\u003eWiFi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ebegin\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eSSID\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003ePASSWORD\u003c/span\u003e);\r\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"WiFi에 연결 중\"\u003c/span\u003e);\r\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eWiFi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e() != \u003cspan class=\"hljs-variable constant_\"\u003eWL_CONNECTED\u003c/span\u003e) {\r\n        \u003cspan class=\"hljs-title function_\"\u003edelay\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e);\r\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e);\r\n    }\r\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"\\nWiFi 네트워크에 연결되었습니다\"\u003c/span\u003e);\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e우리의 Esp8266과 시간을 동기화하기 위해 NTP(Network Time Protocol) 서버를 사용합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esyncTime\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-title function_\"\u003econfigTime\u003c/span\u003e(gmt_offset_sec, daylight_offset_sec, ntp_server);\n    \n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"NTP 시간 동기화를 기다리는 중: \"\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (\u003cspan class=\"hljs-title function_\"\u003etime\u003c/span\u003e(nullptr) \u0026#x3C; \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e3600\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) {\n        \u003cspan class=\"hljs-title function_\"\u003edelay\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"시간이 동기화되었습니다.\"\u003c/span\u003e);\n    \n    struct tm timeinfo;\n    \n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-title function_\"\u003egetLocalTime\u003c/span\u003e(\u0026#x26;timeinfo)) {\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"현재 시간: \"\u003c/span\u003e);\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003easctime\u003c/span\u003e(\u0026#x26;timeinfo));\n    \n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"로컬 시간을 가져오지 못했습니다.\"\u003c/span\u003e);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e브로커에 연결하려면 다음 함수를 사용할 것입니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003econnectToMQTTBroker\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \n    \u003cspan class=\"hljs-comment\"\u003e// 우리의 인증서를 사용하여 신뢰할 수 있는 연결 요청을 수행합니다\u003c/span\u003e\n    \u003cspan class=\"hljs-title class_\"\u003eBearSSL\u003c/span\u003e::X509List \u003cspan class=\"hljs-title function_\"\u003eserverTrustedCA\u003c/span\u003e(ca_cert);\n\n    espClient.\u003cspan class=\"hljs-title function_\"\u003esetTrustAnchors\u003c/span\u003e(\u0026#x26;serverTrustedCA);\n\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (!mqtt_client.\u003cspan class=\"hljs-title function_\"\u003econnected\u003c/span\u003e()) {\n\n        \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e client_id = \u003cspan class=\"hljs-string\"\u003e\"esp8266-client-\"\u003c/span\u003e + \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eWiFi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003emacAddress\u003c/span\u003e());\n        \n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"%s로 MQTT 브로커에 연결 중.....\\n\"\u003c/span\u003e, client_id.\u003cspan class=\"hljs-title function_\"\u003ec_str\u003c/span\u003e());\n        \n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (mqtt_client.\u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e(client_id.\u003cspan class=\"hljs-title function_\"\u003ec_str\u003c/span\u003e(), \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_USERNAME\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_PASSWORD\u003c/span\u003e)) {\n            \n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"MQTT 브로커에 연결되었습니다.\"\u003c/span\u003e);\n        \n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            char err_buf[\u003cspan class=\"hljs-number\"\u003e128\u003c/span\u003e];\n            \n            espClient.\u003cspan class=\"hljs-title function_\"\u003egetLastSSLError\u003c/span\u003e(err_buf, \u003cspan class=\"hljs-title function_\"\u003esizeof\u003c/span\u003e(err_buf));\n            \n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"MQTT 브로커에 연결에 실패했습니다. rc=\"\u003c/span\u003e);\n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(mqtt_client.\u003cspan class=\"hljs-title function_\"\u003estate\u003c/span\u003e());\n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"SSL 오류: \"\u003c/span\u003e);\n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(err_buf);\n\n            \u003cspan class=\"hljs-title function_\"\u003edelay\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e);\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e해당 함수를 사용하여 주제에 대한 데이터를 게시합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003epublishData\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eint data\u003c/span\u003e){\n  \u003cspan class=\"hljs-comment\"\u003e// Int 데이터를 String으로 변환합니다.\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_\"\u003eitoa\u003c/span\u003e(data, payload, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// 주제 \"test\"에 데이터를 게시합니다.\u003c/span\u003e\n  mqtt_client.\u003cspan class=\"hljs-title function_\"\u003epublish\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eMQTT_TOPIC\u003c/span\u003e, payload);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이벤트에 구독하려면 다음과 같이 작성합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esubscribeToTopic\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003echar* topic\u003c/span\u003e){\n\n  mqtt_client.\u003cspan class=\"hljs-title function_\"\u003esubscribe\u003c/span\u003e(topic);\n  \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"주제에 구독함: \"\u003c/span\u003e);\n  \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(topic);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e구독한 주제를 듣습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emqttCallback\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003echar *topic, byte *payload, unsigned int length\u003c/span\u003e) {\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"주제에서 메시지 받음: \"\u003c/span\u003e);\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(topic);\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"메시지:\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (unsigned int i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026#x3C; length; i++) {\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e((char) payload[i]);\n    }\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e();\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"-----------------------\"\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e마지막으로 전체 펌웨어 코드를 작성해 봅시다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#include \u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003eESP8266WiFi\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eh\u003c/span\u003e\u003e\n#include \u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003ePubSubClient\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eh\u003c/span\u003e\u003e\n#include \u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003eESP8266TrueRandom\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eh\u003c/span\u003e\u003e\n#include \u0026#x3C;time.\u003cspan class=\"hljs-property\"\u003eh\u003c/span\u003e\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// NTP 서버 설정\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char *ntp_server = \u003cspan class=\"hljs-string\"\u003e\"0.pool.ntp.org\"\u003c/span\u003e;     \u003cspan class=\"hljs-comment\"\u003e// 기본 NTP 서버\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e long gmt_offset_sec = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;            \u003cspan class=\"hljs-comment\"\u003e// GMT 오프셋(시간대에 따라 조정)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e int daylight_offset_sec = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;        \u003cspan class=\"hljs-comment\"\u003e// 일광 절약 시간 오프셋(초)\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eSSID\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"본인의 와이파이를 사용해주세요\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003ePASSWORD\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"패스워드\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_HOST\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"f4b0e072.ala.asia-southeast1.emqxsl.com\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e int \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_PORT\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e8883\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_USERNAME\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"test2\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_PASSWORD\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"testpass123A\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char* \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_TOPIC\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e;\n\nchar payload[\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e char ca_cert[] = R\u003cspan class=\"hljs-string\"\u003e\"EOF(\n-----BEGIN CERTIFICATE-----\n여기에 인증서 내용을 복사하세요\n-----END CERTIFICATE-----\n)EOF\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-title class_\"\u003eBearSSL\u003c/span\u003e::\u003cspan class=\"hljs-title class_\"\u003eWiFiClientSecure\u003c/span\u003e espClient;\n\u003cspan class=\"hljs-title class_\"\u003ePubSubClient\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emqtt_client\u003c/span\u003e(espClient);\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esubscribeToTopic\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003echar* topic\u003c/span\u003e){\n\n  mqtt_client.\u003cspan class=\"hljs-title function_\"\u003esubscribe\u003c/span\u003e(topic);\n  \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"주제에 구독 완료: \"\u003c/span\u003e);\n  \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(topic);\n}\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emqttCallback\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003echar *topic, byte *payload, unsigned int length\u003c/span\u003e) {\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"주제에서 받은 메시지: \"\u003c/span\u003e);\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(topic);\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"메시지:\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (unsigned int i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026#x3C; length; i++) {\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e((char) payload[i]);\n    }\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e();\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"-----------------------\"\u003c/span\u003e);\n}\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003econnectToMQTTBroker\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \n    \u003cspan class=\"hljs-comment\"\u003e// 인증서를 사용하여 신뢰할 수 있는 연결 요청을 수행합니다\u003c/span\u003e\n    \u003cspan class=\"hljs-title class_\"\u003eBearSSL\u003c/span\u003e::X509List \u003cspan class=\"hljs-title function_\"\u003eserverTrustedCA\u003c/span\u003e(ca_cert);\n\n    espClient.\u003cspan class=\"hljs-title function_\"\u003esetTrustAnchors\u003c/span\u003e(\u0026#x26;serverTrustedCA);\n\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (!mqtt_client.\u003cspan class=\"hljs-title function_\"\u003econnected\u003c/span\u003e()) {\n\n        \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e client_id = \u003cspan class=\"hljs-string\"\u003e\"esp8266-client-\"\u003c/span\u003e + \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eWiFi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003emacAddress\u003c/span\u003e());\n        \n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"%s로 MQTT 브로커에 연결 중.....\\n\"\u003c/span\u003e, client_id.\u003cspan class=\"hljs-title function_\"\u003ec_str\u003c/span\u003e());\n        \n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (mqtt_client.\u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e(client_id.\u003cspan class=\"hljs-title function_\"\u003ec_str\u003c/span\u003e(), \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_USERNAME\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eMQTT_PASSWORD\u003c/span\u003e)) {\n            \n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"MQTT 브로커에 연결됨\"\u003c/span\u003e);\n\n            \u003cspan class=\"hljs-title function_\"\u003esubscribeToTopic\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e);\n        \n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            char err_buf[\u003cspan class=\"hljs-number\"\u003e128\u003c/span\u003e];\n            \n            espClient.\u003cspan class=\"hljs-title function_\"\u003egetLastSSLError\u003c/span\u003e(err_buf, \u003cspan class=\"hljs-title function_\"\u003esizeof\u003c/span\u003e(err_buf));\n            \n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"MQTT 브로커에 연결 실패, 상태=\"\u003c/span\u003e);\n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(mqtt_client.\u003cspan class=\"hljs-title function_\"\u003estate\u003c/span\u003e());\n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"SSL 오류: \"\u003c/span\u003e);\n            \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(err_buf);\n\n            \u003cspan class=\"hljs-title function_\"\u003edelay\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e);\n        }\n    }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esyncTime\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-title function_\"\u003econfigTime\u003c/span\u003e(gmt_offset_sec, daylight_offset_sec, ntp_server);\n    \n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"NTP 시간 동기화 대기 중: \"\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (\u003cspan class=\"hljs-title function_\"\u003etime\u003c/span\u003e(nullptr) \u0026#x3C; \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e3600\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) {\n        \u003cspan class=\"hljs-title function_\"\u003edelay\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"시간 동기화 완료\"\u003c/span\u003e);\n    \n    struct tm timeinfo;\n    \n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-title function_\"\u003egetLocalTime\u003c/span\u003e(\u0026#x26;timeinfo)) {\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"현재 시간: \"\u003c/span\u003e);\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003easctime\u003c/span\u003e(\u0026#x26;timeinfo));\n    \n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"로컬 시간 획득 실패\"\u003c/span\u003e);\n    }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003epublishData\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eint data\u003c/span\u003e){\n  \u003cspan class=\"hljs-comment\"\u003e// 정수 데이터를 문자열로 변환합니다\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_\"\u003eitoa\u003c/span\u003e(data,payload,\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// \"test\" 주제에 데이터를 발행합니다\u003c/span\u003e\n  mqtt_client.\u003cspan class=\"hljs-title function_\"\u003epublish\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eMQTT_TOPIC\u003c/span\u003e,payload);\n}\n\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003econnectToWiFi\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-title class_\"\u003eWiFi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ebegin\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eSSID\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003ePASSWORD\u003c/span\u003e);\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"WiFi에 연결 중\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eWiFi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e() != \u003cspan class=\"hljs-variable constant_\"\u003eWL_CONNECTED\u003c/span\u003e) {\n        \u003cspan class=\"hljs-title function_\"\u003edelay\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e);\n        \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e);\n    }\n    \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"\\nWiFi 네트워크에 연결됨\"\u003c/span\u003e);\n}\n\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetup\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-title class_\"\u003eSerial\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ebegin\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e115200\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-title function_\"\u003econnectToWiFi\u003c/span\u003e();\n\n  \u003cspan class=\"hljs-title function_\"\u003esyncTime\u003c/span\u003e();\n\n  mqtt_client.\u003cspan class=\"hljs-title function_\"\u003esetServer\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eMQTT_HOST\u003c/span\u003e,\u003cspan class=\"hljs-variable constant_\"\u003eMQTT_PORT\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-title function_\"\u003econnectToMQTTBroker\u003c/span\u003e();\n\n}\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eloop\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!mqtt_client.\u003cspan class=\"hljs-title function_\"\u003econnected\u003c/span\u003e()) {\n        \u003cspan class=\"hljs-title function_\"\u003econnectToMQTTBroker\u003c/span\u003e();\n    }\n\n\n    mqtt_client.\u003cspan class=\"hljs-title function_\"\u003eloop\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-comment\"\u003e// 3초마다 무작위 숫자를 보냅니다. 여러분은 센서 데이터를 전송할 수 있습니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_\"\u003epublishData\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eESP8266TrueRandom\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003erandom\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e));\n    \u003cspan class=\"hljs-title function_\"\u003edelay\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e마침내, 코드를 Esp8266에 업로드하세요.\u003c/p\u003e\n\u003cp\u003emqtt-cli를 설치하고 컴퓨터 터미널에서 실행하여 데이터가 발행되는지 확인하세요.\u003c/p\u003e\n\u003cp\u003e설치 후, 다음 명령어를 실행하세요\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003emqtt sub -h \u0026#x3C;호스트\u003e -p \u0026#x3C;포트\u003e -s -u \u0026#x3C;사용자이름\u003e -pw \u0026#x3C;비밀번호\u003e -t \u0026#x3C;토픽\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e우리 경우에는 \"test\" 주제입니다.\u003c/p\u003e\n\u003cp\u003e다음 출력을 볼 수 있습니다.\u003c/p\u003e\n\u003cimg src=\"/assets/img/2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI_8.png\"\u003e\n\u003cp\u003e이것은 우리의 Esp8266이 데이터를 MQTT 브로커로 보내고, 우리 컴퓨터에서 실행되는 CLI 도구를 사용하여 해당 데이터를 구독한다는 것을 보여줍니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003e마지막으로\u003c/h1\u003e\n\u003cp\u003eMQTT를 Esp8266 및 Flutter와 함께 사용하는 방법에 대한 두 부분 가이드의 첫 번째 부분이 끝났습니다.\u003c/p\u003e\n\u003cp\u003e소중한 시간 내주셔서 감사합니다. 이에 대한 생각을 알려주세요!\u003c/p\u003e\n\u003cp\u003e도움이 되었다면 LinkedIn에서 제 소식을 지켜보실 수도 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"https://miro.medium.com/v2/resize:fit:440/0*xIWi3szlPmvPpqh0.gif\" alt=\"Animated GIF\"\u003e\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-22-MQTTinFlutterAComprehensiveGuidetoConnectApplicationswithESP8266IOTDevicesPARTI"},"buildId":"9ddMoNNI_mr3kv4sKx3b_","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>